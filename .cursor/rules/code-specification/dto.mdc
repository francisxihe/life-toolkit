---
description: ç¼–å†™server DTOä»£ç æ—¶
alwaysApply: false
---
éœ€è¦ç”Ÿæˆæˆ–ä¿®æ”¹DTOæ—¶

# DTO è§„èŒƒ

## ğŸ“‹ æ¦‚è¿°

DTO (Data Transfer Object) æ˜¯ç”¨äºæ•°æ®ä¼ è¾“çš„å¯¹è±¡ï¼Œä¸»è¦ç”¨äºæ§åˆ¶å™¨å±‚çš„æ•°æ®éªŒè¯ã€è½¬æ¢å’Œä¼ è¾“ã€‚æœ¬è§„èŒƒå®šä¹‰äº†DTOæ¨¡å—çš„æ ‡å‡†ç»“æ„ã€å‘½åçº¦å®šå’Œæœ€ä½³å®è·µã€‚

## ğŸ—ï¸ ç›®å½•ç»“æ„è§„èŒƒ

### åŸºç¡€ç»“æ„

```
apps/server/src/business/{domain}/{module}/dto/
â”œâ”€â”€ {module}-model.dto.ts      # åŸºç¡€æ¨¡å‹DTO
â”œâ”€â”€ {module}-form.dto.ts       # è¡¨å•æ“ä½œDTO
â”œâ”€â”€ {module}-filter.dto.ts     # è¿‡æ»¤æŸ¥è¯¢DTO
â””â”€â”€ index.ts                   # å¯¼å‡ºæ–‡ä»¶
```

### å®é™…é¡¹ç›®ç»“æ„ç¤ºä¾‹

```
packages/business/server/src/growth/todo/dto/
â”œâ”€â”€ todo-model.dto.ts          # åŸºç¡€æ¨¡å‹DTO
â”œâ”€â”€ todo-form.dto.ts           # è¡¨å•æ“ä½œDTO
â”œâ”€â”€ todo-filter.dto.ts         # è¿‡æ»¤æŸ¥è¯¢DTO
â””â”€â”€ index.ts                   # å¯¼å‡ºæ–‡ä»¶
```

## ğŸ“ æ–‡ä»¶å‘½åè§„èŒƒ

### æ–‡ä»¶å‘½åæ ¼å¼

- **æ¨¡å‹DTO**: `{module}-model.dto.ts`
- **è¡¨å•DTO**: `{module}-form.dto.ts`
- **è¿‡æ»¤DTO**: `{module}-filter.dto.ts`
- **å¯¼å‡ºæ–‡ä»¶**: `index.ts`

### ç±»å‘½åæ ¼å¼

- **åŸºç¡€æ¨¡å‹**: `{Module}Dto` (åŒ…å«æ‰€æœ‰å­—æ®µ)
- **ç®€åŒ–æ¨¡å‹**: `{Module}ModelDto` (æ’é™¤å…³è”å­—æ®µ)
- **åˆ›å»ºè¡¨å•**: `Create{Module}Dto`
- **æ›´æ–°è¡¨å•**: `Update{Module}Dto`
- **åˆ—è¡¨è¿‡æ»¤**: `{Module}ListFilterDto`
- **åˆ†é¡µè¿‡æ»¤**: `{Module}PageFilterDto`

## ğŸ¯ æ ‡å‡†DTOç±»å‹å®šä¹‰

### 1. æ¨¡å‹DTOæ–‡ä»¶ ({module}-model.dto.ts)

#### åŸºç¡€æ¨¡æ¿

```typescript
import { BaseModelDto } from "../../../base/base-model.dto";
import { OmitType, IntersectionType } from "@life-toolkit/mapped-types";
import { {Entity} } from "../{entity}.entity";

// åŸºç¡€DTO - åŒ…å«æ‰€æœ‰å­—æ®µ
export class {Module}Dto extends IntersectionType(
  BaseModelDto,
  OmitType({Entity}, ["relationField1", "relationField2"] as const)
) {
  // æ‰‹åŠ¨æ·»åŠ å…³è”å­—æ®µï¼ˆå¯é€‰ï¼‰
  relationField1?: RelatedDto;
  relationField2?: RelatedDto[];
}

// æ¨¡å‹DTO - æ’é™¤å…³è”å­—æ®µï¼Œç”¨äºç®€å•æ•°æ®ä¼ è¾“
export class {Module}ModelDto extends OmitType({Module}Dto, [
  "relationField1",
  "relationField2",
] as const) {}
```

#### å®Œæ•´ç¤ºä¾‹ï¼ˆæŠ½è±¡åŒ–ï¼‰

```typescript
// module-model.dto.ts
import { BaseModelDto } from "../../../base/base-model.dto";
import { OmitType, IntersectionType } from "@life-toolkit/mapped-types";
import { Module } from "../module.entity";
import { RelatedDto } from "../../related/dto";

// åŸºç¡€DTO - åŒ…å«æ‰€æœ‰å­—æ®µ
export class ModuleDto extends IntersectionType(
  BaseModelDto,
  OmitType(Module, ["related"] as const)
) {
  // å…³è”å­—æ®µ
  related?: RelatedDto;
}

// æ¨¡å‹DTO - æ’é™¤å…³è”å­—æ®µ
export class ModuleModelDto extends OmitType(ModuleDto, [
  "related",
] as const) {}
```

#### å®é™…é¡¹ç›®ç¤ºä¾‹ï¼ˆåŸºäºç°æœ‰ä»£ç ï¼‰

```typescript
// module-model.dto.ts
import { BaseModelDto } from "../../../base/base-model.dto";
import { IntersectionType, OmitType } from "@life-toolkit/mapped-types";
import { Module } from "../module.entity";
import { RelatedDto } from "../../related";

export class ModuleDto extends IntersectionType(
  BaseModelDto,
  OmitType(Module, ["related"] as const)
) {
  related?: RelatedDto;
}

export class ModuleModelDto extends OmitType(ModuleDto, [
  "related",
] as const) {}
```

### 2. è¡¨å•DTOæ–‡ä»¶ ({module}-form.dto.ts)

#### åŸºç¡€æ¨¡æ¿

```typescript
import { PartialType, IntersectionType, PickType, OmitType } from "@life-toolkit/mapped-types";
import { IsOptional, IsArray, IsString, IsEnum } from "class-validator";
import { {Module}Dto } from "./{module}-model.dto";
import { {Entity} } from "../{entity}.entity";

// åˆ›å»ºDTO - é€‰æ‹©éœ€è¦çš„å­—æ®µ
export class Create{Module}Dto extends PickType({Module}Dto, [
  "name",
  "description",
  "status",
  "priority",
  // ... å…¶ä»–éœ€è¦çš„å­—æ®µ
] as const) {
  /** å…³è”å®ä½“IDåˆ—è¡¨ */
  @IsArray()
  @IsString({ each: true })
  @IsOptional()
  relationIds?: string[];

  /** åº”ç”¨åˆ°å®ä½“çš„è¾…åŠ©æ–¹æ³•ï¼ˆå¯é€‰ï¼‰ */
  appendToCreateEntity(entity: {Entity}) {
    if (this.name !== undefined) entity.name = this.name;
    if (this.description !== undefined) entity.description = this.description;
    if (this.status !== undefined) entity.status = this.status;
    // ... å…¶ä»–å­—æ®µæ˜ å°„
  }
}

// æ›´æ–°DTO - åŸºäºåˆ›å»ºDTOçš„éƒ¨åˆ†å­—æ®µ + å®ä½“ID
export class Update{Module}Dto extends IntersectionType(
  PartialType(OmitType(Create{Module}Dto, ["relationIds"] as const)),
  PickType({Entity}, ["id"] as const),
  PickType({Module}Dto, ["completedAt", "cancelledAt"] as const)
) {
  /** åº”ç”¨åˆ°å®ä½“çš„è¾…åŠ©æ–¹æ³•ï¼ˆå¯é€‰ï¼‰ */
  appendToUpdateEntity(entity: {Entity}) {
    if (this.name !== undefined) entity.name = this.name;
    if (this.description !== undefined) entity.description = this.description;
    // ... å…¶ä»–å­—æ®µæ˜ å°„
  }
}
```

#### å®Œæ•´ç¤ºä¾‹ï¼ˆæŠ½è±¡åŒ–ï¼‰

```typescript
// module-form.dto.ts
import {
  PartialType,
  PickType,
  IntersectionType,
  OmitType,
} from "@life-toolkit/mapped-types";
import {
  IsOptional,
  IsArray,
  IsString,
  IsNumber,
  IsEnum,
} from "class-validator";
import { Type } from "class-transformer";
import { ModuleDto } from "./module-model.dto";
import { Module } from "../module.entity";
import { ModuleStatus } from "../module.entity";

// åˆ›å»ºDTO
export class CreateModuleDto extends PickType(ModuleDto, [
  "title",
  "description",
  "importance",
  "status",
  "tags",
  "planDate",
] as const) {
  /** å…³è”å®ä½“ID */
  @IsString()
  @IsOptional()
  relatedId?: string;

  appendToCreateEntity(entity: Module) {
    if (this.title !== undefined) entity.title = this.title;
    if (this.description !== undefined) entity.description = this.description;
    if (this.importance !== undefined) entity.importance = this.importance;
    if (this.status !== undefined) entity.status = this.status;
    if (this.tags !== undefined) entity.tags = this.tags;
    if (this.planDate !== undefined) entity.planDate = this.planDate;
    if (this.relatedId !== undefined) entity.relatedId = this.relatedId;
  }
}

// æ›´æ–°DTO
export class UpdateModuleDto extends IntersectionType(
  PartialType(OmitType(CreateModuleDto, ["relatedId"] as const)),
  PickType(Module, ["id"] as const),
  PickType(ModuleDto, ["doneAt"] as const)
) {
  appendToUpdateEntity(entity: Module) {
    if (this.title !== undefined) entity.title = this.title;
    if (this.description !== undefined) entity.description = this.description;
    if (this.importance !== undefined) entity.importance = this.importance;
    if (this.status !== undefined) entity.status = this.status;
    if (this.tags !== undefined) entity.tags = this.tags;
    if (this.planDate !== undefined) entity.planDate = this.planDate;
    if (this.doneAt !== undefined) entity.doneAt = this.doneAt;
  }
}
```

#### å®é™…é¡¹ç›®ç¤ºä¾‹ï¼ˆåŸºäºç°æœ‰ä»£ç ï¼‰

```typescript
// module-form.dto.ts
import { ModuleDto } from "./module-model.dto";
import {
  PickType,
  IntersectionType,
  PartialType,
  OmitType,
} from "@life-toolkit/mapped-types";
import { Module } from "../module.entity";

export class CreateModuleDto extends PickType(ModuleDto, [
  "title",
  "description",
  "importance",
  "status",
  "tags",
  "planDate",
] as const) {
  relatedId?: string;

  appendToCreateEntity(entity: Module) {
    if (this.title !== undefined) entity.title = this.title;
    if (this.description !== undefined) entity.description = this.description;
    if (this.importance !== undefined) entity.importance = this.importance;
    if (this.status !== undefined) entity.status = this.status;
    if (this.tags !== undefined) entity.tags = this.tags;
    if (this.planDate !== undefined) entity.planDate = this.planDate;
    if (this.relatedId !== undefined) entity.relatedId = this.relatedId;
  }
}

export class UpdateModuleDto extends IntersectionType(
  PartialType(CreateModuleDto),
  PickType(Module, ["id"] as const),
  PickType(ModuleDto, ["doneAt"] as const)
) {
  appendToUpdateEntity(entity: Module) {
    if (this.title !== undefined) entity.title = this.title;
    if (this.description !== undefined) entity.description = this.description;
    if (this.importance !== undefined) entity.importance = this.importance;
    if (this.status !== undefined) entity.status = this.status;
    if (this.tags !== undefined) entity.tags = this.tags;
    if (this.planDate !== undefined) entity.planDate = this.planDate;
    if (this.doneAt !== undefined) entity.doneAt = this.doneAt;
    if (this.relatedId !== undefined) entity.relatedId = this.relatedId;
  }
}
```

### 3. è¿‡æ»¤DTOæ–‡ä»¶ ({module}-filter.dto.ts)

#### åŸºç¡€æ¨¡æ¿

```typescript
import { IsOptional, IsString, IsArray, IsEnum } from "class-validator";
import { Type } from "class-transformer";
import { PageFilterDto } from "../../../common/filter";
import { {Module}Dto } from "./{module}-model.dto";
import { PickType, IntersectionType, PartialType } from "@life-toolkit/mapped-types";
import { {Module}ListFiltersVo, {Module}PageFiltersVo } from "@life-toolkit/vo";

// åˆ—è¡¨è¿‡æ»¤DTO - é€‰æ‹©å¯è¿‡æ»¤çš„å­—æ®µ
export class {Module}ListFilterDto extends PartialType(
  PickType({Module}Dto, ["status", "priority", "relationId"] as const)
) {
  /** æœç´¢å…³é”®è¯ */
  @IsString()
  @IsOptional()
  keyword?: string;

  /** æ—¥æœŸèŒƒå›´è¿‡æ»¤ */
  @IsString()
  @IsOptional()
  dateStart?: string;

  @IsString()
  @IsOptional()
  dateEnd?: string;

  /** å®Œæˆæ—¶é—´èŒƒå›´è¿‡æ»¤ */
  @IsString()
  @IsOptional()
  completedDateStart?: string;

  @IsString()
  @IsOptional()
  completedDateEnd?: string;

  /** å…³è”IDæ•°ç»„è¿‡æ»¤ */
  @IsArray()
  @IsString({ each: true })
  @IsOptional()
  relationIds?: string[];

  /** ä»VOå¯¼å…¥æ•°æ®çš„è¾…åŠ©æ–¹æ³•ï¼ˆå¯é€‰ï¼‰ */
  importListVo(filterVo: {Module}ListFiltersVo) {
    importListVo(filterVo, this);
  }
}

// åˆ†é¡µè¿‡æ»¤DTO - ç»§æ‰¿åˆ—è¡¨è¿‡æ»¤ + åˆ†é¡µ
export class {Module}PageFiltersDto extends IntersectionType(
  PageFilterDto,
  {Module}ListFilterDto
) {
  /** ä»VOå¯¼å…¥æ•°æ®çš„è¾…åŠ©æ–¹æ³•ï¼ˆå¯é€‰ï¼‰ */
  importPageVo(filterVo: {Module}PageFiltersVo) {
    importListVo(filterVo, this);
    this.pageNum = filterVo.pageNum;
    this.pageSize = filterVo.pageSize;
  }
}

// å¯¼å…¥è¾…åŠ©å‡½æ•°
function importListVo(
  filterVo: {Module}ListFiltersVo,
  filterDto: {Module}ListFilterDto
) {
  filterDto.keyword = filterVo.keyword;
  filterDto.dateStart = filterVo.dateStart;
  filterDto.dateEnd = filterVo.dateEnd;
  filterDto.relationIds = filterVo.relationIds;
  // ... å…¶ä»–å­—æ®µæ˜ å°„
}
```

#### å®Œæ•´ç¤ºä¾‹ï¼ˆæŠ½è±¡åŒ–ï¼‰

```typescript
// module-filter.dto.ts
import {
  IsOptional,
  IsString,
  IsArray,
  IsEnum,
  IsNumber,
} from "class-validator";
import { Type } from "class-transformer";
import { PageFilterDto } from "../../../common/filter";
import { ModuleDto } from "./module-model.dto";
import {
  PickType,
  IntersectionType,
  PartialType,
} from "@life-toolkit/mapped-types";
import { ModuleListFiltersVo, ModulePageFiltersVo } from "@life-toolkit/vo";
import { ModuleStatus, ModuleType } from "../module.entity";

// åˆ—è¡¨è¿‡æ»¤DTO
export class ModuleListFilterDto extends PartialType(
  PickType(ModuleDto, ["status", "importance", "relatedId"] as const)
) {
  /** æœç´¢å…³é”®è¯ */
  @IsString()
  @IsOptional()
  keyword?: string;

  /** è®¡åˆ’æ—¥æœŸèŒƒå›´è¿‡æ»¤ */
  @IsString()
  @IsOptional()
  planDateStart?: string;

  @IsString()
  @IsOptional()
  planDateEnd?: string;

  /** å…³è”IDæ•°ç»„è¿‡æ»¤ */
  @IsArray()
  @IsString({ each: true })
  @IsOptional()
  relatedIds?: string[];

  /** çŠ¶æ€æ•°ç»„è¿‡æ»¤ */
  @IsArray()
  @IsEnum(ModuleStatus, { each: true })
  @IsOptional()
  statusList?: ModuleStatus[];

  importListVo(filterVo: ModuleListFiltersVo) {
    importListVo(filterVo, this);
  }
}

// åˆ†é¡µè¿‡æ»¤DTO
export class ModulePageFiltersDto extends IntersectionType(
  PageFilterDto,
  ModuleListFilterDto
) {
  importPageVo(filterVo: ModulePageFiltersVo) {
    importListVo(filterVo, this);
    this.pageNum = filterVo.pageNum;
    this.pageSize = filterVo.pageSize;
  }
}

// å¯¼å…¥è¾…åŠ©å‡½æ•°
function importListVo(
  filterVo: ModuleListFiltersVo,
  filterDto: ModuleListFilterDto
) {
  filterDto.keyword = filterVo.keyword;
  filterDto.planDateStart = filterVo.planDateStart;
  filterDto.planDateEnd = filterVo.planDateEnd;
  filterDto.importance = filterVo.importance;
  filterDto.status = filterVo.status;
  filterDto.relatedIds = filterVo.relatedIds;
  filterDto.statusList = filterVo.statusList;
}
```

#### å®é™…é¡¹ç›®ç¤ºä¾‹ï¼ˆåŸºäºç°æœ‰ä»£ç ï¼‰

```typescript
// module-filter.dto.ts
import { PageFilterDto } from "../../../common/filter";
import { ModuleDto } from "./module-model.dto";
import {
  PickType,
  IntersectionType,
  PartialType,
} from "@life-toolkit/mapped-types";
import { ModuleListFiltersVo, ModulePageFiltersVo } from "@life-toolkit/vo";

export class ModuleListFilterDto extends PartialType(
  PickType(ModuleDto, ["importance", "status", "relatedId"] as const)
) {
  keyword?: string;
  planDateStart?: string;
  planDateEnd?: string;
  relatedIds?: string[];

  importListVo(filterVo: ModuleListFiltersVo) {
    importListVo(filterVo, this);
  }
}

export class ModulePageFiltersDto extends IntersectionType(
  PageFilterDto,
  ModuleListFilterDto
) {
  importPageVo(filterVo: ModulePageFiltersVo) {
    importListVo(filterVo, this);
    this.pageNum = filterVo.pageNum;
    this.pageSize = filterVo.pageSize;
  }
}

function importListVo(
  filterVo: ModuleListFiltersVo,
  filterDto: ModuleListFilterDto
) {
  filterDto.importance = filterVo.importance;
  filterDto.status = filterVo.status;
  filterDto.planDateStart = filterVo.planDateStart;
  filterDto.planDateEnd = filterVo.planDateEnd;
  filterDto.relatedIds = filterVo.relatedIds;
}
```

### 4. å¯¼å‡ºæ–‡ä»¶ (index.ts)

```typescript
// é‡æ–°å¯¼å‡ºæ‰€æœ‰DTO
export * from "./module-model.dto";
export * from "./module-form.dto";
export * from "./module-filter.dto";
```

#### å®é™…é¡¹ç›®ç¤ºä¾‹ï¼ˆåŸºäºç°æœ‰ä»£ç ï¼‰

```typescript
// index.ts
export * from "./module-filter.dto";
export * from "./module-form.dto";
export * from "./module-model.dto";
```

## ğŸ”§ Mapped Types ä½¿ç”¨è§„èŒƒ

### 1. å·¥å…·ç±»å‹å¯¼å…¥

```typescript
import {
  PickType, // é€‰æ‹©ç‰¹å®šå­—æ®µ
  OmitType, // æ’é™¤ç‰¹å®šå­—æ®µ
  PartialType, // æ‰€æœ‰å­—æ®µå˜ä¸ºå¯é€‰
  IntersectionType, // åˆå¹¶å¤šä¸ªç±»å‹
} from "@life-toolkit/mapped-types";
```

### 2. ç±»å‹ç»„åˆç­–ç•¥

#### ç»§æ‰¿é“¾è®¾è®¡

```typescript
// åŸºç¡€ç»§æ‰¿é“¾
BaseModelDto â†’ {Module}Dto â†’ {Module}ModelDto
                          â†’ Create{Module}Dto â†’ Update{Module}Dto

// è¿‡æ»¤ç»§æ‰¿é“¾
PageFilterDto â†’ {Module}PageFiltersDto
{Module}Dto â†’ {Module}ListFilterDto â†’ {Module}PageFiltersDto
```

#### ç»„åˆæ¨¡å¼

```typescript
// é€‰æ‹©å­—æ®µ - åˆ›å»ºæ—¶éœ€è¦çš„å­—æ®µ
export class CreateDto extends PickType(BaseDto, [
  "name",
  "description",
  "status",
]) {}

// æ’é™¤å­—æ®µ - ç§»é™¤å…³è”å­—æ®µçš„ç®€åŒ–ç‰ˆæœ¬
export class ModelDto extends OmitType(BaseDto, [
  "relationField",
  "complexField",
]) {}

// éƒ¨åˆ†å­—æ®µ - æ›´æ–°æ—¶æ‰€æœ‰å­—æ®µå¯é€‰
export class UpdateDto extends PartialType(CreateDto) {}

// åˆå¹¶ç±»å‹ - åˆ†é¡µè¿‡æ»¤ = åˆ†é¡µå‚æ•° + è¿‡æ»¤æ¡ä»¶
export class PageFilterDto extends IntersectionType(
  PageFilterDto,
  ListFilterDto
) {}

// å¤æ‚ç»„åˆ - æ›´æ–°DTO = éƒ¨åˆ†åˆ›å»ºå­—æ®µ + å®ä½“ID + å®Œæˆæ—¶é—´å­—æ®µ
export class UpdateDto extends IntersectionType(
  PartialType(OmitType(CreateDto, ["relationIds"])),
  PickType(Entity, ["id"]),
  PickType(BaseDto, ["completedAt", "cancelledAt"])
) {}
```

### 3. éªŒè¯è£…é¥°å™¨è§„èŒƒ

#### åŸºç¡€éªŒè¯è£…é¥°å™¨

```typescript
import {
  IsString, // å­—ç¬¦ä¸²éªŒè¯
  IsNumber, // æ•°å­—éªŒè¯
  IsBoolean, // å¸ƒå°”å€¼éªŒè¯
  IsEnum, // æšä¸¾éªŒè¯
  IsArray, // æ•°ç»„éªŒè¯
  IsOptional, // å¯é€‰å­—æ®µæ ‡è®°
  IsISO8601, // ISO8601æ—¥æœŸæ ¼å¼éªŒè¯
  IsInt, // æ•´æ•°éªŒè¯
  IsEmail, // é‚®ç®±éªŒè¯
  IsUrl, // URLéªŒè¯
  Min, // æœ€å°å€¼éªŒè¯
  Max, // æœ€å¤§å€¼éªŒè¯
  Length, // é•¿åº¦éªŒè¯
  IsDateString, // æ—¥æœŸå­—ç¬¦ä¸²éªŒè¯
} from "class-validator";

import { Type } from "class-transformer";
```

#### å­—æ®µç±»å‹éªŒè¯æ˜ å°„è¡¨

```typescript
const VALIDATION_MAPPING = {
  // åŸºç¡€ç±»å‹
  string: "@IsString()",
  number: "@IsNumber() @Type(() => Number)",
  boolean: "@IsBoolean() @Type(() => Boolean)",

  // æ—¥æœŸç±»å‹
  date: "@IsISO8601() @Type(() => Date)",
  dateString: "@IsDateString()",

  // æšä¸¾å’Œæ•°ç»„
  enum: "@IsEnum(EnumType)",
  array: "@IsArray() @IsString({ each: true })",

  // ç‰¹æ®Šæ ¼å¼
  email: "@IsEmail() @IsString()",
  url: "@IsUrl() @IsString()",

  // å¯é€‰æ ‡è®°
  optional: "@IsOptional()",

  // æ•°å€¼èŒƒå›´
  int: "@IsInt() @Type(() => Number)",
  minMax: "@Min(min) @Max(max) @Type(() => Number)",
  length: "@Length(min, max)",
};
```

#### éªŒè¯ç¤ºä¾‹

```typescript
export class CreateProductDto {
  /** äº§å“åç§° - å¿…å¡«å­—ç¬¦ä¸² */
  @IsString()
  @Length(1, 100)
  name: string;

  /** äº§å“æè¿° - å¯é€‰å­—ç¬¦ä¸² */
  @IsString()
  @IsOptional()
  @Length(0, 1000)
  description?: string;

  /** ä»·æ ¼ - å¿…å¡«æ•°å­— */
  @IsNumber()
  @Type(() => Number)
  @Min(0)
  price: number;

  /** åº“å­˜æ•°é‡ - å¯é€‰æ•´æ•° */
  @IsInt()
  @Type(() => Number)
  @IsOptional()
  @Min(0)
  stockQuantity?: number;

  /** äº§å“çŠ¶æ€ - å¯é€‰æšä¸¾ */
  @IsEnum(ProductStatus)
  @IsOptional()
  status?: ProductStatus;

  /** æ ‡ç­¾ - å¯é€‰å­—ç¬¦ä¸²æ•°ç»„ */
  @IsArray()
  @IsString({ each: true })
  @IsOptional()
  tags?: string[];

  /** åˆ›å»ºæ—¶é—´ - æ—¥æœŸå­—ç¬¦ä¸² */
  @IsDateString()
  @IsOptional()
  createdAt?: string;

  /** åˆ†ç±»ID - å¯é€‰å­—ç¬¦ä¸² */
  @IsString()
  @IsOptional()
  categoryId?: string;
}
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. èŒè´£åˆ†ç¦»åŸåˆ™

- **Model DTO**: æ•°æ®ç»“æ„å®šä¹‰ï¼ŒåŒ…å«æ‰€æœ‰å­—æ®µï¼Œç”¨äºå†…éƒ¨ä¼ è¾“å’ŒAPIå“åº”
- **Form DTO**: è¡¨å•æ“ä½œéªŒè¯ï¼ŒåŒ…å«åˆ›å»ºå’Œæ›´æ–°æ‰€éœ€çš„å­—æ®µ
- **Filter DTO**: æŸ¥è¯¢æ¡ä»¶éªŒè¯ï¼ŒåŒ…å«åˆ—è¡¨å’Œåˆ†é¡µçš„è¿‡æ»¤å‚æ•°

### 2. ç±»å‹å®‰å…¨ä¼˜å…ˆ

```typescript
// âœ… æ¨èï¼šä½¿ç”¨ Mapped Types å¤ç”¨ç±»å‹å®šä¹‰
export class UpdateDto extends PartialType(CreateDto) {}

// âŒ é¿å…ï¼šæ‰‹åŠ¨é‡å¤å®šä¹‰å­—æ®µ
export class UpdateDto {
  title?: string;
  description?: string;
  status?: StatusEnum;
  // ... é‡å¤å­—æ®µå®šä¹‰
}
```

### 3. éªŒè¯ä¸€è‡´æ€§

```typescript
// ä¿æŒ Entity å’Œ DTO çš„éªŒè¯è§„åˆ™ä¸€è‡´
// Entity ä¸­çš„éªŒè¯è§„åˆ™
@Column()
@IsString()
@Length(1, 100)
title: string;

// DTO ä¸­çš„éªŒè¯ï¼ˆé€šè¿‡ PickType ç»§æ‰¿ï¼‰
export class CreateDto extends PickType(Entity, ["title"]) {}

// æˆ–æ‰‹åŠ¨æ·»åŠ éªŒè¯
export class CreateDto extends PickType(BaseDto, ["title"]) {
  @IsString()
  @Length(1, 100)
  title: string;
}
```

### 4. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

```typescript
// ä½¿ç”¨ç»§æ‰¿å‡å°‘é‡å¤ä»£ç 
export class BaseFilterDto {
  @IsString()
  @IsOptional()
  keyword?: string;

  @IsString()
  @IsOptional()
  dateStart?: string;

  @IsString()
  @IsOptional()
  dateEnd?: string;
}

// ç»§æ‰¿åŸºç¡€è¿‡æ»¤å™¨
export class ProductListFilterDto extends IntersectionType(
  BaseFilterDto,
  PartialType(PickType(ProductDto, ["status", "categoryId"]))
) {}
```

### 5. å…³è”æ•°æ®å¤„ç†

```typescript
// åˆ›å»ºæ—¶å¤„ç†å…³è”å…³ç³»
export class CreateOrderDto extends PickType(OrderDto, ["items", "userId"]) {
  /** è®¢å•é¡¹IDåˆ—è¡¨ */
  @IsArray()
  @IsString({ each: true })
  @IsOptional()
  itemIds?: string[];

  appendToCreateEntity(entity: Order) {
    // æ˜ å°„åŸºæœ¬å­—æ®µ
    if (this.userId !== undefined) entity.userId = this.userId;

    // å¤„ç†å…³è”é¡¹æ˜ å°„
    if (this.itemIds?.length) {
      // å…³è”é€»è¾‘åœ¨ Service å±‚å¤„ç†
    }
  }
}
```

### 6. é”™è¯¯å¤„ç†å’ŒéªŒè¯åé¦ˆ

```typescript
// ä½¿ç”¨è‡ªå®šä¹‰éªŒè¯è£…é¥°å™¨
export class CreateUserDto extends PickType(UserDto, ["email", "password"]) {
  @IsEmail(
    {},
    {
      message: "è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€",
    }
  )
  email: string;

  @IsString()
  @Length(8, 20, {
    message: "å¯†ç é•¿åº¦å¿…é¡»åœ¨8-20ä¸ªå­—ç¬¦ä¹‹é—´",
  })
  password: string;
}
```

## ğŸ”„ å¸¸è§æ¨¡å¼

### 1. åŸºç¡€CRUDæ¨¡å¼

```typescript
// 1. åˆ›å»ºDTO - é€‰æ‹©åˆ›å»ºæ—¶éœ€è¦çš„å­—æ®µ
export class CreateProductDto extends PickType(ProductDto, [
  "name",
  "description",
  "price",
  "categoryId",
  "tags",
]) {
  /** å…³è”å›¾ç‰‡IDåˆ—è¡¨ */
  @IsArray()
  @IsString({ each: true })
  @IsOptional()
  imageIds?: string[];
}

// 2. æ›´æ–°DTO - åˆ›å»ºDTOçš„éƒ¨åˆ†å­—æ®µ + å®ä½“ID + å®ŒæˆçŠ¶æ€å­—æ®µ
export class UpdateProductDto extends IntersectionType(
  PartialType(OmitType(CreateProductDto, ["imageIds"])),
  PickType(Product, ["id"]),
  PickType(ProductDto, ["status", "updatedAt"])
) {}

// 3. åˆ—è¡¨è¿‡æ»¤DTO - åŸºç¡€è¿‡æ»¤æ¡ä»¶
export class ProductListFilterDto extends PartialType(
  PickType(ProductDto, ["status", "categoryId", "price"])
) {
  @IsString()
  @IsOptional()
  keyword?: string;

  @IsString()
  @IsOptional()
  createdDateStart?: string;

  @IsString()
  @IsOptional()
  createdDateEnd?: string;
}

// 4. åˆ†é¡µè¿‡æ»¤DTO - åˆ—è¡¨è¿‡æ»¤ + åˆ†é¡µå‚æ•°
export class ProductPageFiltersDto extends IntersectionType(
  PageFilterDto,
  ProductListFilterDto
) {}
```

### 2. å…³è”æ•°æ®å¤„ç†æ¨¡å¼

```typescript
// å¤„ç†å¤šå¯¹å¤šå…³è”
export class CreateArticleDto extends PickType(ArticleDto, [
  "title",
  "content",
  "authorId",
]) {
  /** æ ‡ç­¾IDåˆ—è¡¨ */
  @IsArray()
  @IsString({ each: true })
  @IsOptional()
  tagIds?: string[];

  /** åˆ†ç±»IDåˆ—è¡¨ */
  @IsArray()
  @IsString({ each: true })
  @IsOptional()
  categoryIds?: string[];

  appendToCreateEntity(entity: Article) {
    if (this.title !== undefined) entity.title = this.title;
    if (this.content !== undefined) entity.content = this.content;
    if (this.authorId !== undefined) entity.authorId = this.authorId;
    // å…³è”å…³ç³»åœ¨Serviceå±‚å¤„ç†
  }
}

// å¤„ç†ä¸€å¯¹å¤šå…³è”
export class CreateOrderDto extends PickType(OrderDto, [
  "userId",
  "totalAmount",
]) {
  /** è®¢å•é¡¹åˆ—è¡¨ */
  @IsArray()
  @IsOptional()
  items?: CreateOrderItemDto[];

  /** æ”¶è´§åœ°å€ä¿¡æ¯ */
  @IsOptional()
  shippingAddress?: CreateAddressDto;
}
```

### 3. å¤æ‚è¿‡æ»¤æ¨¡å¼

```typescript
// é«˜çº§è¿‡æ»¤å™¨ - ç»§æ‰¿åŸºç¡€è¿‡æ»¤å™¨å¹¶æ·»åŠ å¤æ‚æ¡ä»¶
export class ProductAdvancedFilterDto extends ProductListFilterDto {
  /** ä»·æ ¼èŒƒå›´è¿‡æ»¤ */
  @IsNumber()
  @Type(() => Number)
  @IsOptional()
  priceMin?: number;

  @IsNumber()
  @Type(() => Number)
  @IsOptional()
  priceMax?: number;

  /** åº“å­˜èŒƒå›´è¿‡æ»¤ */
  @IsNumber()
  @Type(() => Number)
  @IsOptional()
  stockMin?: number;

  @IsNumber()
  @Type(() => Number)
  @IsOptional()
  stockMax?: number;

  /** å¤šçŠ¶æ€è¿‡æ»¤ */
  @IsArray()
  @IsEnum(ProductStatus, { each: true })
  @IsOptional()
  statusList?: ProductStatus[];

  /** æ ‡ç­¾è¿‡æ»¤ */
  @IsArray()
  @IsString({ each: true })
  @IsOptional()
  tags?: string[];

  /** è¯„åˆ†èŒƒå›´ */
  @IsNumber()
  @Type(() => Number)
  @IsOptional()
  @Min(1)
  @Max(5)
  ratingMin?: number;

  @IsNumber()
  @Type(() => Number)
  @IsOptional()
  @Min(1)
  @Max(5)
  ratingMax?: number;
}
```

### 4. åµŒå¥—DTOæ¨¡å¼

```typescript
// çˆ¶å­ç»“æ„DTO
export class CreateCategoryDto extends PickType(CategoryDto, [
  "name",
  "description",
]) {
  /** å­åˆ†ç±» */
  @IsOptional()
  @Type(() => CreateCategoryDto)
  children?: CreateCategoryDto[];
}

// æ ‘å½¢ç»“æ„å“åº”DTO
export class CategoryTreeDto extends CategoryDto {
  /** å­åˆ†ç±»åˆ—è¡¨ */
  children?: CategoryTreeDto[];

  /** å±‚çº§æ·±åº¦ */
  @IsNumber()
  @IsOptional()
  depth?: number;
}
```

## ğŸš« ç¦æ­¢äº‹é¡¹

1. **ä¸è¦åœ¨DTOä¸­åŒ…å«ä¸šåŠ¡é€»è¾‘** - DTOä»…ç”¨äºæ•°æ®ä¼ è¾“å’ŒéªŒè¯ï¼Œå¤æ‚é€»è¾‘åº”åœ¨Serviceå±‚
2. **ä¸è¦ä½¿ç”¨ `any` ç±»å‹** - åº”æ˜ç¡®å®šä¹‰å…·ä½“ç±»å‹ï¼Œé¿å…ç±»å‹å®‰å…¨é—®é¢˜
3. **ä¸è¦å¿½ç•¥éªŒè¯è£…é¥°å™¨** - æ‰€æœ‰å­—æ®µéƒ½åº”æœ‰é€‚å½“çš„éªŒè¯è§„åˆ™
4. **ä¸è¦é‡å¤å®šä¹‰ç›¸åŒçš„å­—æ®µ** - ä½¿ç”¨ Mapped Types å¤ç”¨ç±»å‹å®šä¹‰
5. **ä¸è¦åœ¨DTOä¸­ç›´æ¥æ“ä½œæ•°æ®åº“** - æ•°æ®æ“ä½œåº”åœ¨ Service/Repository å±‚
6. **ä¸è¦åˆ›å»ºå¾ªç¯ä¾èµ–** - DTOä¹‹é—´åº”é¿å…ç›¸äº’å¼•ç”¨
7. **ä¸è¦è¿‡åº¦è®¾è®¡** - åªå®šä¹‰å®é™…éœ€è¦çš„å­—æ®µå’ŒéªŒè¯è§„åˆ™

## âœ… æ£€æŸ¥æ¸…å•

åœ¨åˆ›å»ºæˆ–ä¿®æ”¹DTOæ—¶ï¼Œè¯·ç¡®è®¤ä»¥ä¸‹äº‹é¡¹ï¼š

### åŸºç¡€ç»“æ„

- [ ] æ–‡ä»¶å‘½åç¬¦åˆè§„èŒƒ (`{module}-{type}.dto.ts`)
- [ ] ç±»å‘½åç¬¦åˆè§„èŒƒ (`{Module}{Type}Dto`)
- [ ] ä½¿ç”¨äº†åˆé€‚çš„ Mapped Types (`@life-toolkit/mapped-types`)
- [ ] å¯¼å…¥äº†å¿…è¦çš„éªŒè¯è£…é¥°å™¨

### ç»§æ‰¿å…³ç³»

- [ ] æ­£ç¡®ç»§æ‰¿è‡ª `BaseModelDto`
- [ ] ä½¿ç”¨äº†åˆé€‚çš„å·¥å…·ç±»å‹ (PickType, OmitType, PartialTypeç­‰)
- [ ] é¿å…äº†é‡å¤çš„å­—æ®µå®šä¹‰
- [ ] ç»§æ‰¿é“¾æ¸…æ™°åˆç†

### éªŒè¯è§„åˆ™

- [ ] æ‰€æœ‰å­—æ®µéƒ½æœ‰é€‚å½“çš„éªŒè¯è£…é¥°å™¨
- [ ] å¯é€‰å­—æ®µä½¿ç”¨äº† `@IsOptional()`
- [ ] æ•°å­—å­—æ®µä½¿ç”¨äº† `@Type(() => Number)`
- [ ] æ—¥æœŸå­—æ®µä½¿ç”¨äº† `@IsISO8601()` æˆ– `@IsDateString()`
- [ ] æšä¸¾å­—æ®µä½¿ç”¨äº† `@IsEnum()`
- [ ] æ•°ç»„å­—æ®µä½¿ç”¨äº† `@IsArray()`
- [ ] å­—ç¬¦ä¸²æ•°ç»„ä½¿ç”¨äº† `@IsString({ each: true })`

### å­—æ®µè®¾è®¡

- [ ] å­—æ®µç±»å‹å®šä¹‰æ­£ç¡®
- [ ] å…³è”å­—æ®µå¤„ç†åˆç†ï¼ˆä½¿ç”¨IDåˆ—è¡¨æˆ–åµŒå¥—DTOï¼‰
- [ ] è¿‡æ»¤æ¡ä»¶å®Œæ•´ä¸”å®ç”¨
- [ ] é»˜è®¤å€¼è®¾ç½®åˆç†

### ä»£ç è´¨é‡

- [ ] å¯¼å…¥äº†å¿…è¦çš„ä¾èµ–
- [ ] é¿å…äº†å¾ªç¯ä¾èµ–
- [ ] æ³¨é‡Šæ¸…æ™°å‡†ç¡®
- [ ] éµå¾ªäº†é¡¹ç›®çš„ç¼–ç è§„èŒƒ

## ğŸ“ å®Œæ•´ç¤ºä¾‹ï¼ˆåŸºäºå®é™…é¡¹ç›®ï¼‰

```typescript
// product-model.dto.ts
import { BaseModelDto } from "../../../base/base-model.dto";
import { IntersectionType, OmitType } from "@life-toolkit/mapped-types";
import { Product } from "../product.entity";
import { CategoryDto } from "../../category/dto";

export class ProductDto extends IntersectionType(
  BaseModelDto,
  OmitType(Product, ["category", "reviews", "images"] as const)
) {
  // å…³è”å­—æ®µ
  category?: CategoryDto;
  reviews?: ReviewDto[];
  images?: ImageDto[];
}

export class ProductModelDto extends OmitType(ProductDto, [
  "category",
  "reviews",
  "images",
] as const) {}

// product-form.dto.ts
import {
  PartialType,
  PickType,
  IntersectionType,
  OmitType,
} from "@life-toolkit/mapped-types";
import {
  IsOptional,
  IsArray,
  IsString,
  IsNumber,
  IsEnum,
} from "class-validator";
import { Type } from "class-transformer";
import { ProductDto } from "./product-model.dto";
import { Product } from "../product.entity";
import { ProductStatus } from "../product.entity";

export class CreateProductDto extends PickType(ProductDto, [
  "name",
  "description",
  "price",
  "categoryId",
  "tags",
] as const) {
  /** å›¾ç‰‡IDåˆ—è¡¨ */
  @IsArray()
  @IsString({ each: true })
  @IsOptional()
  imageIds?: string[];

  appendToCreateEntity(entity: Product) {
    if (this.name !== undefined) entity.name = this.name;
    if (this.description !== undefined) entity.description = this.description;
    if (this.price !== undefined) entity.price = this.price;
    if (this.categoryId !== undefined) entity.categoryId = this.categoryId;
    if (this.tags !== undefined) entity.tags = this.tags;
  }
}

export class UpdateProductDto extends IntersectionType(
  PartialType(OmitType(CreateProductDto, ["imageIds"])),
  PickType(Product, ["id"]),
  PickType(ProductDto, ["status", "updatedAt"])
) {
  appendToUpdateEntity(entity: Product) {
    if (this.name !== undefined) entity.name = this.name;
    if (this.description !== undefined) entity.description = this.description;
    if (this.price !== undefined) entity.price = this.price;
    if (this.status !== undefined) entity.status = this.status;
  }
}

// product-filter.dto.ts
import {
  IsOptional,
  IsString,
  IsArray,
  IsEnum,
  IsNumber,
} from "class-validator";
import { Type } from "class-transformer";
import { PageFilterDto } from "../../../common/filter";
import { ProductDto } from "./product-model.dto";
import {
  PickType,
  IntersectionType,
  PartialType,
} from "@life-toolkit/mapped-types";
import { ProductListFiltersVo, ProductPageFiltersVo } from "@life-toolkit/vo";
import { ProductStatus } from "../product.entity";

export class ProductListFilterDto extends PartialType(
  PickType(ProductDto, ["status", "categoryId", "price"])
) {
  /** æœç´¢å…³é”®è¯ */
  @IsString()
  @IsOptional()
  keyword?: string;

  /** åˆ›å»ºæ—¶é—´èŒƒå›´è¿‡æ»¤ */
  @IsString()
  @IsOptional()
  createdDateStart?: string;

  @IsString()
  @IsOptional()
  createdDateEnd?: string;

  /** ä»·æ ¼èŒƒå›´è¿‡æ»¤ */
  @IsOptional()
  @Type(() => Number)
  priceMin?: number;

  @IsOptional()
  @Type(() => Number)
  priceMax?: number;

  /** åˆ†ç±»IDæ•°ç»„è¿‡æ»¤ */
  @IsArray()
  @IsString({ each: true })
  @IsOptional()
  categoryIds?: string[];

  /** çŠ¶æ€æ•°ç»„è¿‡æ»¤ */
  @IsArray()
  @IsEnum(ProductStatus, { each: true })
  @IsOptional()
  statusList?: ProductStatus[];

  /** æ ‡ç­¾è¿‡æ»¤ */
  @IsArray()
  @IsString({ each: true })
  @IsOptional()
  tags?: string[];

  importListVo(filterVo: ProductListFiltersVo) {
    importListVo(filterVo, this);
  }
}

export class ProductPageFiltersDto extends IntersectionType(
  PageFilterDto,
  ProductListFilterDto
) {
  importPageVo(filterVo: ProductPageFiltersVo) {
    importListVo(filterVo, this);
    this.pageNum = filterVo.pageNum;
    this.pageSize = filterVo.pageSize;
  }
}

// å¯¼å…¥è¾…åŠ©å‡½æ•°
function importListVo(
  filterVo: ProductListFiltersVo,
  filterDto: ProductListFilterDto
) {
  filterDto.keyword = filterVo.keyword;
  filterDto.createdDateStart = filterVo.createdDateStart;
  filterDto.createdDateEnd = filterVo.createdDateEnd;
  filterDto.priceMin = filterVo.priceMin;
  filterDto.priceMax = filterVo.priceMax;
  filterDto.categoryIds = filterVo.categoryIds;
  filterDto.statusList = filterVo.statusList;
  filterDto.tags = filterVo.tags;
}

// index.ts
export * from "./product-model.dto";
export * from "./product-form.dto";
export * from "./product-filter.dto";
```