---
description: éœ€è¦å¢åˆ æ”¹æŸ¥Mapperä¸­ä»£ç æ—¶
globs: 
alwaysApply: false
---
éœ€è¦ç”Ÿæˆæˆ–ä¿®æ”¹Mapperæ—¶

# Mapper è§„èŒƒ

## ğŸ“‹ æ¦‚è¿°

Mapper æ˜¯ç”¨äºä¸åŒæ•°æ®å±‚ä¹‹é—´å¯¹è±¡è½¬æ¢çš„å·¥å…·ç±»ï¼Œä¸»è¦è´Ÿè´£ Entityã€DTOã€VO ä¹‹é—´çš„æ•°æ®æ˜ å°„ã€‚æœ¬è§„èŒƒå®šä¹‰äº† Mapper çš„æ ‡å‡†æ¶æ„ã€å‘½åçº¦å®šå’Œæœ€ä½³å®è·µã€‚

## ğŸ—ï¸ ç›®å½•ç»“æ„è§„èŒƒ

### åŸºç¡€ç»“æ„
```
apps/server/src/business/{domain}/{module}/mappers/
â””â”€â”€ {module}.mapper.ts           # ä¸»æ˜ å°„å™¨æ–‡ä»¶
```

### ç¤ºä¾‹ç»“æ„
```
apps/server/src/business/growth/goal/mappers/
â””â”€â”€ goal.mapper.ts               # ç›®æ ‡æ˜ å°„å™¨

apps/server/src/business/growth/habit/mappers/
â””â”€â”€ habit.mapper.ts              # ä¹ æƒ¯æ˜ å°„å™¨
```

## ğŸ“ æ–‡ä»¶å‘½åè§„èŒƒ

### æ–‡ä»¶å‘½åæ ¼å¼
- **æ˜ å°„å™¨æ–‡ä»¶**: `{module}.mapper.ts`
- **ç±»å‘½å**: `{Module}Mapper`

## ğŸ¯ ç®€åŒ–çš„Mapperæ¶æ„

### 1. æ¶æ„è®¾è®¡åŸåˆ™
```typescript
// ç®€åŒ–çš„ä¸¤å±‚æ¶æ„
{Module}MapperCore (æ ¸å¿ƒè½¬æ¢é€»è¾‘)
    â†“ extends
{Module}Mapper (æœ€ç»ˆå¯¼å‡ºç±»)
```

### 2. å®Œæ•´Mapperæ¨¡æ¿
```typescript
import type { {Module} as {Module}VO } from "@life-toolkit/vo";
import { Create{Module}Dto, Update{Module}Dto, {Module}Dto, {Module}ModelDto } from "../dto";
import { {Module} } from "../entities";
import { BaseMapper } from "@/base/base.mapper";
import dayjs from "dayjs";

// æ ¸å¿ƒæ˜ å°„å™¨ç±»
class {Module}MapperCore {
  // ==================== Entity â†” DTO ====================
  
  /**
   * å®ä½“è½¬æ¨¡å‹DTO
   */
  static entityToModelDto(entity: {Module}): {Module}ModelDto {
    const dto = new {Module}ModelDto();
    Object.assign(dto, BaseMapper.entityToDto(entity));
    
    // åŸºç¡€å­—æ®µæ˜ å°„
    dto.field1 = entity.field1;
    dto.field2 = entity.field2;
    dto.status = entity.status;
    dto.priority = entity.priority;
    
    // æ—¥æœŸå­—æ®µæ˜ å°„ (ä¿æŒDateç±»å‹)
    dto.startDate = entity.startDate;
    dto.endDate = entity.endDate;
    dto.completedAt = entity.completedAt;
    
    // æ•°ç»„å­—æ®µæ˜ å°„
    dto.tags = entity.tags || [];
    
    return dto;
  }

  /**
   * å®ä½“è½¬å®Œæ•´DTO
   */
  static entityToDto(entity: {Module}): {Module}Dto {
    const dto = new {Module}Dto();
    Object.assign(dto, this.entityToModelDto(entity));
    
    // å…³è”å­—æ®µæ˜ å°„ (ç®€åŒ–å¤„ç†ï¼Œé¿å…å¾ªç¯å¼•ç”¨)
    dto.relationField1 = entity.relationField1;
    dto.relationField2 = entity.relationField2;
    
    return dto;
  }

  // ==================== DTO â†” VO ====================
  
  /**
   * DTOè½¬é¡¹ç›®VO
   */
  static dtoToItemVo(dto: {Module}Dto): {Module}VO.{Module}ItemVo {
    const vo: {Module}VO.{Module}ItemVo = {
      // åŸºç¡€å­—æ®µ
      ...BaseMapper.dtoToVo(dto),
      
      // ä¸šåŠ¡å­—æ®µ
      field1: dto.field1 || "",
      field2: dto.field2 || DefaultValue,
      status: dto.status,
      priority: dto.priority,
      
      // æ—¥æœŸå­—æ®µè½¬æ¢ (Date â†’ string)
      startDate: dto.startDate
        ? dayjs(dto.startDate).format("YYYY-MM-DD")
        : "",
      endDate: dto.endDate
        ? dayjs(dto.endDate).format("YYYY-MM-DD")
        : undefined,
      completedAt: dto.completedAt
        ? dayjs(dto.completedAt).format("YYYY-MM-DD HH:mm:ss")
        : undefined,
      
      // æ•°ç»„å­—æ®µ
      tags: dto.tags || [],
    };
    
    return vo;
  }

  /**
   * DTOè½¬å®Œæ•´VO
   */
  static dtoToVo(dto: {Module}Dto): {Module}VO.{Module}Vo {
    const vo: {Module}VO.{Module}Vo = {
      ...this.dtoToItemVo(dto),
      
      // å…³è”æ•°æ®å­—æ®µ (ç®€åŒ–å¤„ç†)
      relationField1: dto.relationField1 || [],
      relationField2: dto.relationField2 || [],
    };
    
    return vo;
  }

  /**
   * DTOåˆ—è¡¨è½¬VOåˆ—è¡¨
   */
  static dtoToVoList(dtoList: {Module}Dto[]): {Module}VO.{Module}ItemVo[] {
    return dtoList.map((dto) => this.dtoToItemVo(dto));
  }

  /**
   * DTOè½¬åˆ†é¡µVO
   */
  static dtoToPageVo(
    dtoList: {Module}Dto[],
    total: number,
    pageNum: number,
    pageSize: number
  ): {Module}VO.{Module}PageVo {
    return {
      list: this.dtoToVoList(dtoList),
      total,
      pageNum,
      pageSize,
      hasNext: pageNum * pageSize < total,
      hasPrev: pageNum > 1,
    };
  }

  /**
   * DTOè½¬åˆ—è¡¨VO
   */
  static dtoToListVo(dtoList: {Module}Dto[]): {Module}VO.{Module}ListVo {
    return {
      list: this.dtoToVoList(dtoList),
    };
  }

  // ==================== VO â†” DTO ====================
  
  /**
   * åˆ›å»ºVOè½¬DTO
   */
  static voToCreateDto(vo: {Module}VO.Create{Module}Vo): Create{Module}Dto {
    const dto = new Create{Module}Dto();
    
    // åŸºç¡€å­—æ®µ
    dto.field1 = vo.field1;
    dto.field2 = vo.field2;
    dto.priority = vo.priority;
    
    // æ—¥æœŸå­—æ®µè½¬æ¢ (string â†’ Date)
    dto.startDate = vo.startDate ? dayjs(vo.startDate).toDate() : new Date();
    dto.endDate = vo.endDate ? dayjs(vo.endDate).toDate() : undefined;
    
    // æ•°ç»„å­—æ®µ
    dto.tags = vo.tags || [];
    
    // å…³è”å­—æ®µ
    dto.relationIds = vo.relationIds;
    
    return dto;
  }

  /**
   * æ›´æ–°VOè½¬DTO
   */
  static voToUpdateDto(vo: {Module}VO.Update{Module}Vo): Update{Module}Dto {
    const dto = new Update{Module}Dto();
    
    // åªæ›´æ–°æä¾›çš„å­—æ®µ
    if (vo.field1 !== undefined) {
      dto.field1 = vo.field1;
    }
    if (vo.field2 !== undefined) {
      dto.field2 = vo.field2;
    }
    if (vo.priority !== undefined) {
      dto.priority = vo.priority;
    }
    if (vo.startDate !== undefined) {
      dto.startDate = vo.startDate ? dayjs(vo.startDate).toDate() : undefined;
    }
    if (vo.endDate !== undefined) {
      dto.endDate = vo.endDate ? dayjs(vo.endDate).toDate() : undefined;
    }
    if (vo.tags !== undefined) {
      dto.tags = vo.tags;
    }
    if (vo.relationIds !== undefined) {
      dto.relationIds = vo.relationIds;
    }
    
    return dto;
  }
}

// æœ€ç»ˆå¯¼å‡ºç±»
export class {Module}Mapper extends {Module}MapperCore {}
```

## ğŸ”§ å­—æ®µæ˜ å°„è§„èŒƒ

### 1. åŸºç¡€å­—æ®µæ˜ å°„
```typescript
// å­—ç¬¦ä¸²å­—æ®µ
dto.name = entity.name;
vo.name = dto.name || "";

// æ•°å­—å­—æ®µ
dto.importance = entity.importance;
vo.importance = dto.importance ?? 0;

// å¸ƒå°”å­—æ®µ
dto.isActive = entity.isActive;
vo.isActive = dto.isActive || false;

// æ•°ç»„å­—æ®µ
dto.tags = entity.tags || [];
vo.tags = dto.tags || [];

// æšä¸¾å­—æ®µ
dto.status = entity.status;
vo.status = dto.status;
```

### 2. æ—¥æœŸå­—æ®µæ˜ å°„
```typescript
// Entity â†’ DTO (ä¿æŒDateç±»å‹)
dto.createdAt = entity.createdAt;
dto.startDate = entity.startDate;

// DTO â†’ VO (è½¬æ¢ä¸ºå­—ç¬¦ä¸²)
vo.createdAt = dto.createdAt
  ? dayjs(dto.createdAt).format("YYYY-MM-DD HH:mm:ss")
  : "";
vo.startDate = dto.startDate
  ? dayjs(dto.startDate).format("YYYY-MM-DD")
  : "";

// VO â†’ DTO (è½¬æ¢ä¸ºDate)
dto.startDate = vo.startDate ? dayjs(vo.startDate).toDate() : new Date();
dto.endDate = vo.endDate ? dayjs(vo.endDate).toDate() : undefined;
```

### 3. æšä¸¾å­—æ®µæ˜ å°„
```typescript
// Entity â†’ DTO (ç›´æ¥èµ‹å€¼)
dto.status = entity.status;

// DTO â†’ VO (ç›´æ¥èµ‹å€¼)
vo.status = dto.status;

// VO â†’ DTO (ç±»å‹å®‰å…¨è½¬æ¢)
dto.status = vo.status as EntityStatus;
```

### 4. å…³è”å­—æ®µæ˜ å°„
```typescript
// Entity â†’ DTO (ç›´æ¥èµ‹å€¼ï¼Œé¿å…æ·±åº¦é€’å½’)
dto.parent = entity.parent;
dto.children = entity.children;

// DTO â†’ VO (ç®€åŒ–å¤„ç†ï¼Œé¿å…å¾ªç¯å¼•ç”¨)
vo.parent = dto.parent ? this.dtoToItemVo(dto.parent) : undefined;
vo.children = []; // ç®€åŒ–å¤„ç†ï¼Œéœ€è¦æ—¶å•ç‹¬åŠ è½½

// å…³è”IDå¤„ç†
vo.parentId = dto.parent?.id;
dto.parentId = vo.parentId;
```

### 5. å¯é€‰å­—æ®µå¤„ç†
```typescript
// å®‰å…¨çš„å­—æ®µè®¿é—®
vo.description = dto.description ?? "";
vo.endDate = dto.endDate 
  ? dayjs(dto.endDate).format("YYYY-MM-DD")
  : undefined;

// æ›´æ–°æ—¶çš„å­—æ®µå¤„ç†
if (vo.description !== undefined) {
  dto.description = vo.description;
}
```

## ğŸ¯ ä½¿ç”¨è§„èŒƒ

### 1. é™æ€æ–¹æ³•è°ƒç”¨
```typescript
// åœ¨Serviceä¸­ä½¿ç”¨
const dto = GoalMapper.entityToDto(entity);
const vo = GoalMapper.dtoToVo(dto);

// åœ¨Controllerä¸­ä½¿ç”¨
const createDto = GoalMapper.voToCreateDto(createVo);
const pageVo = GoalMapper.dtoToPageVo(dtoList, total, pageNum, pageSize);
```

### 2. å¯¼å…¥è§„èŒƒ
```typescript
// åœ¨Serviceä¸­å¯¼å…¥
import { GoalMapper } from "./mappers/goal.mapper";

// åœ¨Controllerä¸­å¯¼å…¥
import { GoalMapper } from "../mappers/goal.mapper";
```

### 3. Moduleé…ç½®
```typescript
// ä¸éœ€è¦åœ¨Moduleä¸­æ³¨å†ŒMapper
@Module({
  providers: [GoalService], // åªæ³¨å†ŒService
  controllers: [GoalController],
})
export class GoalModule {}
```

## ğŸ”„ æœ€ä½³å®è·µ

### 1. é”™è¯¯å¤„ç†
```typescript
// å®‰å…¨çš„å­—æ®µè®¿é—®
static dtoToVo(dto: GoalDto): GoalVO.GoalVo {
  if (!dto) {
    throw new Error("DTOä¸èƒ½ä¸ºç©º");
  }
  
  const vo: GoalVO.GoalVo = {
    ...BaseMapper.dtoToVo(dto),
    title: dto.title || "",
    status: dto.status || GoalStatus.ACTIVE,
    startDate: dto.startDate 
      ? dayjs(dto.startDate).format("YYYY-MM-DD")
      : dayjs().format("YYYY-MM-DD"),
  };
  
  return vo;
}
```

### 2. æ€§èƒ½ä¼˜åŒ–
```typescript
// æ‰¹é‡è½¬æ¢ä¼˜åŒ–
static dtoToVoList(dtoList: GoalDto[]): GoalVO.GoalItemVo[] {
  if (!dtoList || dtoList.length === 0) {
    return [];
  }
  
  return dtoList.map(dto => this.dtoToItemVo(dto));
}

// é¿å…æ·±åº¦é€’å½’
static dtoToVo(dto: GoalDto): GoalVO.GoalVo {
  return {
    ...this.dtoToItemVo(dto),
    children: [], // ç®€åŒ–å¤„ç†ï¼Œé¿å…æ€§èƒ½é—®é¢˜
    tasks: [],    // éœ€è¦æ—¶å•ç‹¬åŠ è½½
  };
}
```

### 3. ç±»å‹å®‰å…¨
```typescript
// æ˜ç¡®çš„ç±»å‹å®šä¹‰
static dtoToItemVo(dto: GoalDto): GoalVO.GoalItemVo {
  const vo: GoalVO.GoalItemVo = {
    // ç¡®ä¿æ‰€æœ‰å¿…éœ€å­—æ®µéƒ½æœ‰å€¼
    ...BaseMapper.dtoToVo(dto),
    title: dto.title || "",
    status: dto.status || GoalStatus.ACTIVE,
    priority: dto.priority || 1,
    importance: dto.importance ?? 3,
    isPublic: dto.isPublic || false,
    startDate: dto.startDate 
      ? dayjs(dto.startDate).format("YYYY-MM-DD")
      : dayjs().format("YYYY-MM-DD"),
    tags: dto.tags || [],
    userId: dto.userId,
  };
  
  return vo;
}
```

### 4. æ—¥æœŸå¤„ç†æ ‡å‡†åŒ–
```typescript
// ç»Ÿä¸€çš„æ—¥æœŸæ ¼å¼åŒ–å‡½æ•°
private static formatDate(date: Date | undefined, format: string = "YYYY-MM-DD"): string | undefined {
  return date ? dayjs(date).format(format) : undefined;
}

private static parseDate(dateString: string | undefined): Date | undefined {
  return dateString ? dayjs(dateString).toDate() : undefined;
}

// ä½¿ç”¨ç¤ºä¾‹
vo.startDate = this.formatDate(dto.startDate);
vo.completedAt = this.formatDate(dto.completedAt, "YYYY-MM-DD HH:mm:ss");
dto.startDate = this.parseDate(vo.startDate);
```

## ğŸ”„ å¸¸è§æ¨¡å¼

### 1. åŸºç¡€CRUDæ˜ å°„
```typescript
// åˆ›å»ºï¼šVO â†’ DTO â†’ Entity
CreateVo â†’ CreateDto â†’ Entity

// æŸ¥è¯¢ï¼šEntity â†’ DTO â†’ ItemVo
Entity â†’ Dto â†’ ItemVo

// æ›´æ–°ï¼šUpdateVo â†’ UpdateDto â†’ Entity
UpdateVo â†’ UpdateDto â†’ Entity

// åˆ—è¡¨ï¼šEntity[] â†’ Dto[] â†’ ItemVo[]
Entity[] â†’ Dto[] â†’ ItemVo[]
```

### 2. åˆ†é¡µæ•°æ®æ˜ å°„
```typescript
static dtoToPageVo(
  dtoList: GoalDto[],
  total: number,
  pageNum: number,
  pageSize: number
): GoalVO.GoalPageVo {
  return {
    list: this.dtoToVoList(dtoList),
    total,
    pageNum,
    pageSize,
    hasNext: pageNum * pageSize < total,
    hasPrev: pageNum > 1,
  };
}
```

### 3. å…³è”æ•°æ®å¤„ç†
```typescript
// ç®€å•å…³è”ï¼ˆIDå¼•ç”¨ï¼‰
vo.parentId = dto.parent?.id;
vo.userId = dto.user?.id;

// å¤æ‚å…³è”ï¼ˆå¯¹è±¡åµŒå¥—ï¼ŒæŒ‰éœ€å¤„ç†ï¼‰
vo.parent = dto.parent ? this.dtoToItemVo(dto.parent) : undefined;
vo.children = []; // ç®€åŒ–å¤„ç†ï¼Œéœ€è¦æ—¶å•ç‹¬åŠ è½½
```

## ğŸš« ç¦æ­¢äº‹é¡¹

1. **ä¸è¦åœ¨Mapperä¸­åŒ…å«ä¸šåŠ¡é€»è¾‘** - Mapperä»…è´Ÿè´£æ•°æ®è½¬æ¢
2. **ä¸è¦ä½¿ç”¨ä¾èµ–æ³¨å…¥** - ä½¿ç”¨é™æ€æ–¹æ³•æ¨¡å¼
3. **ä¸è¦å¿½ç•¥ç©ºå€¼æ£€æŸ¥** - å§‹ç»ˆå¤„ç†undefined/nullæƒ…å†µ
4. **ä¸è¦åˆ›å»ºå¾ªç¯å¼•ç”¨** - åˆç†å¤„ç†å…³è”å¯¹è±¡è½¬æ¢
5. **ä¸è¦æ··åˆä¸åŒå±‚çº§çš„è½¬æ¢** - ä¿æŒåˆ†å±‚æ¸…æ™°
6. **ä¸è¦åœ¨è½¬æ¢ä¸­è¿›è¡Œæ•°æ®åº“æ“ä½œ** - è½¬æ¢åº”è¯¥æ˜¯çº¯å‡½æ•°
7. **ä¸è¦å¿½ç•¥ç±»å‹å®‰å…¨** - ç¡®ä¿ç±»å‹è½¬æ¢çš„æ­£ç¡®æ€§

## âœ… æ£€æŸ¥æ¸…å•

åœ¨åˆ›å»ºæˆ–ä¿®æ”¹Mapperæ—¶ï¼Œè¯·ç¡®è®¤ä»¥ä¸‹äº‹é¡¹ï¼š

### åŸºç¡€ç»“æ„
- [ ] æ–‡ä»¶å‘½åç¬¦åˆè§„èŒƒ (`{module}.mapper.ts`)
- [ ] ç±»å‘½åç¬¦åˆè§„èŒƒ (`{Module}Mapper`)
- [ ] ä½¿ç”¨äº†ç®€åŒ–çš„ä¸¤å±‚æ¶æ„
- [ ] æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯é™æ€æ–¹æ³•

### è½¬æ¢æ–¹æ³•
- [ ] å®ç°äº† `entityToDto` æ–¹æ³•
- [ ] å®ç°äº† `entityToModelDto` æ–¹æ³•
- [ ] å®ç°äº† `dtoToVo` æ–¹æ³•
- [ ] å®ç°äº† `dtoToItemVo` æ–¹æ³•
- [ ] å®ç°äº† `voToCreateDto` æ–¹æ³•
- [ ] å®ç°äº† `voToUpdateDto` æ–¹æ³•

### å­—æ®µå¤„ç†
- [ ] æ­£ç¡®å¤„ç†äº†æ—¥æœŸå­—æ®µè½¬æ¢
- [ ] æ·»åŠ äº†å¿…è¦çš„ç©ºå€¼æ£€æŸ¥
- [ ] å…³è”å­—æ®µå¤„ç†æ­£ç¡®
- [ ] æšä¸¾å­—æ®µè½¬æ¢å®‰å…¨
- [ ] æ•°ç»„å­—æ®µå¤„ç†å®Œæ•´

### æ€§èƒ½è€ƒè™‘
- [ ] é¿å…äº†æ·±åº¦é€’å½’
- [ ] æ‰¹é‡è½¬æ¢ä¼˜åŒ–åˆç†
- [ ] å…³è”æ•°æ®ç®€åŒ–å¤„ç†
- [ ] æ²¡æœ‰ä¸å¿…è¦çš„è®¡ç®—

### ä»£ç è´¨é‡
- [ ] ç§»é™¤äº†ä¾èµ–æ³¨å…¥ç›¸å…³ä»£ç 
- [ ] æ²¡æœ‰åŒ…å«ä¸šåŠ¡é€»è¾‘ä»£ç 
- [ ] ç±»å‹å®šä¹‰æ˜ç¡®
- [ ] é”™è¯¯å¤„ç†å®Œå–„

## ğŸ“ å®Œæ•´ç¤ºä¾‹

```typescript
// goal.mapper.ts
import type { Goal as GoalVO } from "@life-toolkit/vo";
import { CreateGoalDto, UpdateGoalDto, GoalDto, GoalModelDto } from "../dto";
import { Goal, GoalStatus, GoalPriority } from "../entities";
import { BaseMapper } from "@/base/base.mapper";
import dayjs from "dayjs";

class GoalMapperCore {
  // ==================== Entity â†” DTO ====================
  
  static entityToModelDto(entity: Goal): GoalModelDto {
    const dto = new GoalModelDto();
    Object.assign(dto, BaseMapper.entityToDto(entity));
    
    dto.title = entity.title;
    dto.description = entity.description;
    dto.status = entity.status;
    dto.priority = entity.priority;
    dto.importance = entity.importance;
    dto.isPublic = entity.isPublic;
    dto.startDate = entity.startDate;
    dto.targetDate = entity.targetDate;
    dto.completedAt = entity.completedAt;
    dto.tags = entity.tags || [];
    dto.userId = entity.userId;
    
    return dto;
  }

  static entityToDto(entity: Goal): GoalDto {
    const dto = new GoalDto();
    Object.assign(dto, this.entityToModelDto(entity));
    
    dto.tasks = entity.tasks;
    dto.user = entity.user;
    
    return dto;
  }

  // ==================== DTO â†” VO ====================
  
  static dtoToItemVo(dto: GoalDto): GoalVO.GoalItemVo {
    const vo: GoalVO.GoalItemVo = {
      ...BaseMapper.dtoToVo(dto),
      title: dto.title || "",
      description: dto.description,
      status: dto.status || GoalStatus.ACTIVE,
      priority: dto.priority || GoalPriority.MEDIUM,
      importance: dto.importance ?? 3,
      isPublic: dto.isPublic || false,
      startDate: dto.startDate
        ? dayjs(dto.startDate).format("YYYY-MM-DD")
        : dayjs().format("YYYY-MM-DD"),
      targetDate: dto.targetDate
        ? dayjs(dto.targetDate).format("YYYY-MM-DD")
        : undefined,
      completedAt: dto.completedAt
        ? dayjs(dto.completedAt).format("YYYY-MM-DD HH:mm:ss")
        : undefined,
      tags: dto.tags || [],
      userId: dto.userId,
    };
    
    return vo;
  }

  static dtoToVo(dto: GoalDto): GoalVO.GoalVo {
    const vo: GoalVO.GoalVo = {
      ...this.dtoToItemVo(dto),
      tasks: [], // ç®€åŒ–å¤„ç†
      user: undefined, // éœ€è¦æ—¶å•ç‹¬åŠ è½½
    };
    
    return vo;
  }

  static dtoToVoList(dtoList: GoalDto[]): GoalVO.GoalItemVo[] {
    return dtoList.map((dto) => this.dtoToItemVo(dto));
  }

  static dtoToPageVo(
    dtoList: GoalDto[],
    total: number,
    pageNum: number,
    pageSize: number
  ): GoalVO.GoalPageVo {
    return {
      list: this.dtoToVoList(dtoList),
      total,
      pageNum,
      pageSize,
      hasNext: pageNum * pageSize < total,
      hasPrev: pageNum > 1,
    };
  }

  // ==================== VO â†” DTO ====================
  
  static voToCreateDto(vo: GoalVO.CreateGoalVo): CreateGoalDto {
    const dto = new CreateGoalDto();
    
    dto.title = vo.title;
    dto.description = vo.description;
    dto.priority = vo.priority || GoalPriority.MEDIUM;
    dto.importance = vo.importance ?? 3;
    dto.isPublic = vo.isPublic || false;
    dto.startDate = vo.startDate ? dayjs(vo.startDate).toDate() : new Date();
    dto.targetDate = vo.targetDate ? dayjs(vo.targetDate).toDate() : undefined;
    dto.tags = vo.tags || [];
    dto.userId = vo.userId;
    dto.taskIds = vo.taskIds;
    
    return dto;
  }

  static voToUpdateDto(vo: GoalVO.UpdateGoalVo): UpdateGoalDto {
    const dto = new UpdateGoalDto();
    
    if (vo.title !== undefined) dto.title = vo.title;
    if (vo.description !== undefined) dto.description = vo.description;
    if (vo.priority !== undefined) dto.priority = vo.priority;
    if (vo.importance !== undefined) dto.importance = vo.importance;
    if (vo.isPublic !== undefined) dto.isPublic = vo.isPublic;
    if (vo.startDate !== undefined) {
      dto.startDate = vo.startDate ? dayjs(vo.startDate).toDate() : undefined;
    }
    if (vo.targetDate !== undefined) {
      dto.targetDate = vo.targetDate ? dayjs(vo.targetDate).toDate() : undefined;
    }
    if (vo.tags !== undefined) dto.tags = vo.tags;
    if (vo.taskIds !== undefined) dto.taskIds = vo.taskIds;
    
    return dto;
  }
}

export class GoalMapper extends GoalMapperCore {}
```
