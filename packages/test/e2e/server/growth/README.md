# Growth模块接口测试

本目录包含Growth模块（包括待办事项、任务、目标和时间跟踪等功能）的端到端API测试。

## 独立请求模式

本测试模块现已更新为使用独立请求模式，不再依赖于服务器应用的`AppModule`。这种模式具有以下优势：

- **解耦测试与应用**：测试不再依赖服务器应用的内部模块结构
- **更接近真实使用场景**：通过HTTP请求直接测试API，更贴近实际用户使用情况
- **灵活性更高**：可以针对任何环境的服务器进行测试（本地、开发、生产等）

在测试运行前，确保目标服务器已启动，并可以通过环境变量`API_BASE_URL`设置目标服务器地址（默认为`http://localhost:3000`）。

## 文件结构

```
/e2e/growth/
├── README.md               # 本文档
├── index.spec.ts           # 主测试文件
├── todo.controller.spec.ts # 待办事项接口测试
├── task.controller.spec.ts # 任务接口测试
├── goal.controller.spec.ts # 目标接口测试
└── track-time.spec.ts      # 时间跟踪相关测试
```

## 测试内容

这些测试文件涵盖了Growth模块的以下功能：

1. **待办事项(Todo)**：创建、读取、更新、删除待办事项，以及状态转换（完成、放弃、恢复）等操作
2. **任务(Task)**：创建、读取、更新、删除任务，以及状态转换和时间跟踪相关功能
3. **目标(Goal)**：创建、读取、更新、删除目标，以及状态转换和目标管理相关功能
4. **时间跟踪(TrackTime)**：与任务关联的时间跟踪功能测试

## 如何运行测试

### 前置条件

在运行测试前，确保：

1. 目标API服务器已启动并可访问
2. 已通过环境变量或配置文件设置正确的API地址和数据库连接信息

### 运行所有测试

```bash
# 在项目根目录下执行
npm run test:e2e -- growth

# 或者在apps/server目录下执行
npm run test:e2e -- growth
```

### 运行特定模块的测试

```bash
# 只运行待办事项测试
npm run test:e2e -- growth/todo.controller

# 只运行任务测试
npm run test:e2e -- growth/task.controller

# 只运行目标测试
npm run test:e2e -- growth/goal.controller

# 只运行时间跟踪测试
npm run test:e2e -- growth/track-time
```

## 注意事项

1. 测试会在数据库中创建真实的测试数据，并在测试完成后尝试清理。如需更彻底的隔离，建议配置专门的测试数据库。

2. 所有测试都是自包含的，即每个测试文件都会创建自己需要的测试数据，无需依赖其他测试的执行结果。

3. 测试中的`idList`、创建日期等动态数据需要在实际运行中获取，测试代码会自动处理这些情况。

4. 若要添加新的测试用例，请遵循已有的测试结构，确保测试之间的独立性。

## 常见问题排查

1. **测试无法连接服务器**：确保API服务已启动，并检查`API_BASE_URL`环境变量或默认值是否正确

2. **测试数据清理失败**：检查`afterAll`和`afterEach`钩子中的清理逻辑

3. **特定API测试失败**：检查API参数格式和值，确保与接口要求一致

4. **权限问题**：确保测试环境中已正确设置权限（如需要） 