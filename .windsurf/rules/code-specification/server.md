---
trigger: model_decision
description: Life Toolkit å®Œæ•´å¼€å‘æµç¨‹è§„èŒƒ
globs:
---

# Life Toolkit å®Œæ•´å¼€å‘æµç¨‹è§„èŒƒ

## ğŸ“‹ æ¦‚è¿°

æœ¬è§„èŒƒå®šä¹‰äº† Life Toolkit é¡¹ç›®ä»æ•°æ®æ ¼å¼å®šä¹‰åˆ°æ§åˆ¶å™¨å®ç°çš„å®Œæ•´å¼€å‘æµç¨‹ï¼Œç¡®ä¿å„å±‚çº§ä»£ç è§„èŒƒç»Ÿä¸€ã€æ¥å£ä¸€è‡´ã€æµç¨‹è¿è´¯ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„æ€»è§ˆ

### åˆ†å±‚æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å®¢æˆ·ç«¯å±‚ (Client Layer)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                å‰ç«¯åº”ç”¨ (Web/Desktop)                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é€‚é…å±‚ (Adapter Layer)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Server API    â”‚  Desktop IPC    â”‚   Mobile API     â”‚   â”‚
â”‚  â”‚   (HTTP/REST)   â”‚   (Electron)    â”‚   (è®¡åˆ’ä¸­...)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ä¸šåŠ¡å±‚ (Business Layer)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Controller    â”‚    Service      â”‚   Repository     â”‚   â”‚
â”‚  â”‚   (ä¸šåŠ¡é€»è¾‘)    â”‚   (ä¸šåŠ¡è§„åˆ™)    â”‚   (æ•°æ®è®¿é—®)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•°æ®å±‚ (Data Layer)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     Entity      â”‚           VO/DTO                    â”‚   â”‚
â”‚  â”‚   (æ•°æ®æ¨¡å‹)    â”‚   (æ•°æ®ä¼ è¾“ + å†…ç½®æ˜ å°„æ–¹æ³•)         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¼€å‘æµç¨‹æ€»è§ˆ

```
1. æ•°æ®æ ¼å¼å®šä¹‰ â†’ 2. ä¸šåŠ¡é€»è¾‘ â†’ 3. æ§åˆ¶å™¨ â†’ 4. å­—æ®µæ§åˆ¶
    â†“                â†“            â†“            â†“
  Entityè§„èŒƒ      Repository    Controller   Field Manage
  DTO/VOè§„èŒƒ      Serviceè§„èŒƒ   Serviceè§„èŒƒ  Filterè§„èŒƒ
```

## ğŸ”„ å®Œæ•´å¼€å‘æµç¨‹

### ç¬¬ä¸€é˜¶æ®µï¼šæ•°æ®æ ¼å¼å®šä¹‰

#### 1.1 Entity å®šä¹‰ï¼ˆæ•°æ®æ¨¡å‹ï¼‰
**ä½ç½®**: `packages/business/server/src/{domain}/{module}/entities/*.entity.ts`

**æ ¸å¿ƒåŸåˆ™**:
- ç»§æ‰¿ `BaseEntity` è·å–åŸºç¡€å­—æ®µ
- ä½¿ç”¨ TypeORM è£…é¥°å™¨å®šä¹‰å­—æ®µç±»å‹å’Œçº¦æŸ
- æ˜ç¡®å…³è”å…³ç³»å’Œçº§è”æ“ä½œ

**ç¤ºä¾‹ä»£ç **:
```typescript
// packages/business/server/src/{domain}/{module}/{module}.entity.ts
import { BaseEntity } from "../../base/base.entity";
import { EntityStatus, EntityType } from "@life-toolkit/enum";
import { Entity, Column, ManyToOne, JoinColumn } from "typeorm";
import { IsString, IsOptional, IsEnum, IsBoolean } from "class-validator";
import { Type } from "class-transformer";

export class ModuleModel extends BaseEntity {
  /** åç§° */
  @Column("varchar")
  @IsString()
  name!: string;

  /** æè¿° */
  @Column("text", { nullable: true })
  @IsString()
  @IsOptional()
  description?: string;

  /** çŠ¶æ€ */
  @Column({
    type: "varchar",
    length: 20,
    nullable: true,
  })
  @IsEnum(EntityStatus)
  status!: EntityStatus;

  /** ä¼˜å…ˆçº§ */
  @Column("int", { nullable: true })
  @IsNumber()
  @IsOptional()
  @Type(() => Number)
  priority?: number;

  /** å¤„ç†æ—¶é—´ */
  @Column("datetime", { nullable: true })
  processedAt?: Date;
}

@Entity("module")
export class Module extends ModuleModel {
  /** å…³è”ä¸Šçº§ */
  @ManyToOne(() => Module, { nullable: true })
  @JoinColumn({ name: "parent_id" })
  parent?: Module;

  @Column("varchar", { nullable: true })
  parentId?: string;
}
```

#### 1.2 DTO å®šä¹‰ï¼ˆæ•°æ®ä¼ è¾“å¯¹è±¡ï¼‰
**ä½ç½®**: `packages/business/server/src/{domain}/{module}/dto/`

**æ ¸å¿ƒåŸåˆ™**:
- åŒºåˆ†åˆ›å»ºã€æ›´æ–°ã€æŸ¥è¯¢ç­‰ä¸åŒåœºæ™¯çš„ DTO
- ä½¿ç”¨ class-validator è¿›è¡Œæ•°æ®éªŒè¯
- ä½¿ç”¨ class-transformer è¿›è¡Œæ•°æ®è½¬æ¢

**ç¤ºä¾‹ä»£ç **:
```typescript
// packages/business/server/src/{domain}/{module}/dto/create-{module}.dto.ts
import { IsString, IsOptional, IsEnum, IsNumber, IsISO8601 } from "class-validator";
import { Type } from "class-transformer";
import { EntityStatus } from "@life-toolkit/enum";

export class CreateModuleDto {
  /** åç§° */
  @IsString()
  name!: string;

  /** æè¿° */
  @IsString()
  @IsOptional()
  description?: string;

  /** çŠ¶æ€ */
  @IsEnum(EntityStatus)
  @IsOptional()
  status?: EntityStatus;

  /** ä¼˜å…ˆçº§ */
  @IsNumber()
  @IsOptional()
  @Type(() => Number)
  priority?: number;

  /** è®¡åˆ’æ—¥æœŸ */
  @IsISO8601()
  @IsOptional()
  planDate?: string;
}
```

#### 1.3 VO å®šä¹‰ï¼ˆå€¼å¯¹è±¡ï¼‰
**ä½ç½®**: `packages/business/vo/{domain}/{module}/`

**æ ¸å¿ƒåŸåˆ™**:
- å®šä¹‰å‰ç«¯å±•ç¤ºå’Œæ¥å£ä¼ è¾“çš„æ•°æ®æ ¼å¼
- ä¿æŒä¸åç«¯ DTO çš„æ˜ å°„å…³ç³»
- ç¡®ä¿ç±»å‹å®‰å…¨å’Œæ•°æ®ä¸€è‡´æ€§

**ç¤ºä¾‹ä»£ç **:
```typescript
// packages/business/vo/{domain}/{module}/{module}.vo.ts
export namespace ModuleVO {
  export interface ModuleItemVo {
    id: string;
    name: string;
    description?: string;
    status: EntityStatus;
    priority?: number;
    planDate?: string;
    processedAt?: string;
    createdAt: string;
    updatedAt: string;
  }

  export interface CreateModuleVo {
    name: string;
    description?: string;
    priority?: number;
    planDate?: string;
  }

  export interface UpdateModuleVo {
    name?: string;
    description?: string;
    status?: EntityStatus;
    priority?: number;
    planDate?: string;
  }
}
```

### ç¬¬äºŒé˜¶æ®µï¼šä¸šåŠ¡é€»è¾‘å®ç°

#### 2.1 Repository å®šä¹‰ï¼ˆæ•°æ®è®¿é—®å±‚ï¼‰
**ä½ç½®**: `packages/business/server/src/{domain}/{module}/*.repository.ts`

**æ ¸å¿ƒåŸåˆ™**:
- å®ç°æ•°æ®è®¿é—®æ¥å£
- ä½¿ç”¨ DTO å†…ç½®æ–¹æ³•è¿›è¡Œ Entity â†” DTO è½¬æ¢
- å¤„ç†å¤æ‚æŸ¥è¯¢å’Œå…³è”å…³ç³»

**ç¤ºä¾‹ä»£ç **:
```typescript
// packages/business/server/src/{domain}/{module}/{module}.repository.ts
import { Module } from "./entities/{module}.entity";
import { ModuleDto, CreateModuleDto, UpdateModuleDto } from "./dto";

export abstract class ModuleRepository {
  async create(createDto: CreateModuleDto): Promise<ModuleDto> {
    const entity = this.repo.create(createDto);
    const saved = await this.repo.save(entity);
    return ModuleDto.importEntity(saved);
  }

  async findById(id: string): Promise<ModuleDto | null> {
    const entity = await this.repo.findOne({ where: { id } });
    return entity ? ModuleDto.importEntity(entity) : null;
  }

  static createDtoToEntity(createDto: CreateModuleDto): Partial<Module> {
    return {
      name: createDto.name,
      description: createDto.description,
      status: createDto.status || EntityStatus.ACTIVE,
      priority: createDto.priority,
      planDate: createDto.planDate ? new Date(createDto.planDate) : undefined,
    };
  }
}
```

### ç¬¬ä¸‰é˜¶æ®µï¼šä¸šåŠ¡é€»è¾‘

#### 3.1 Repository Interface å®šä¹‰ï¼ˆæ•°æ®è®¿é—®å¥‘çº¦ï¼‰
**ä½ç½®**: `packages/business/server/src/{domain}/{module}/*.repository.ts`

**æ ¸å¿ƒåŸåˆ™**:
- å®šä¹‰æ•°æ®è®¿é—®çš„ç»Ÿä¸€æ¥å£
- æ”¯æŒè·¨å¹³å°å®ç°
- æ˜ç¡®æ–¹æ³•ç­¾åå’Œè¿”å›ç±»å‹

**ç¤ºä¾‹ä»£ç **:
```typescript
// packages/business/server/src/{domain}/{module}/{module}.repository.ts
import { Module } from "./{module}.entity";
import { CreateModuleDto, UpdateModuleDto, ModulePageFiltersDto, ModuleListFilterDto, ModuleDto } from "./dto";

export interface ModuleRepository {
  // åˆ›å»ºæ“ä½œ
  create(createModuleDto: CreateModuleDto): Promise<ModuleDto>;
  createWithExtras(createModuleDto: CreateModuleDto, extras: Partial<Module>): Promise<ModuleDto>;

  // æŸ¥è¯¢æ“ä½œ
  findByFilter(filter: ModuleListFilterDto): Promise<ModuleDto[]>;
  page(filter: ModulePageFiltersDto): Promise<{
    list: ModuleDto[];
    total: number;
    pageNum: number;
    pageSize: number;
  }>;
  findById(id: string, relations?: string[]): Promise<ModuleDto>;

  // æ›´æ–°æ“ä½œ
  update(id: string, updateModuleDto: UpdateModuleDto): Promise<ModuleDto>;
  batchUpdate(includeIds: string[], updateModuleDto: UpdateModuleDto): Promise<ModuleDto[]>;

  // åˆ é™¤æ“ä½œ
  delete(id: string): Promise<boolean>;
  deleteByFilter(filter: ModulePageFiltersDto): Promise<void>;
  softDeleteByParentIds(parentIds: string[]): Promise<void>;

  // ç‰¹æ®Šä¸šåŠ¡æ“ä½œ
  updateParentId(id: string, parentId: string): Promise<void>;
}
```

#### 3.2 Repository Server å®ç°ï¼ˆMySQL/PostgreSQLï¼‰
**ä½ç½®**: `apps/server/src/business/{domain}/{module}/*.repository.ts`

**æ ¸å¿ƒåŸåˆ™**:
- ä½¿ç”¨ TypeORM å®ç°å¤æ‚æŸ¥è¯¢
- æ”¯æŒäº‹åŠ¡ç®¡ç†å’Œå…³è”æŸ¥è¯¢
- ä¼˜åŒ–æ•°æ®åº“æ€§èƒ½

**ç¤ºä¾‹ä»£ç **:
```typescript
// apps/server/src/business/{domain}/{module}/{module}.repository.ts
@Injectable()
export class ModuleRepository {
  constructor(
    @InjectRepository(Module)
    private readonly moduleRepository: Repository<Module>
  ) {}

  async create(createModuleDto: CreateModuleDto): Promise<ModuleDto> {
    const module = this.moduleRepository.create({
      ...createModuleDto,
      status: EntityStatus.ACTIVE,
      planDate: createModuleDto.planDate ? dayjs(createModuleDto.planDate).format("YYYY-MM-DD") : undefined,
    });

    await this.moduleRepository.save(module);
    return this.findById(module.id);
  }

  async page(filter: ModulePageFiltersDto): Promise<{
    list: ModuleDto[];
    total: number;
    pageNum: number;
    pageSize: number;
  }> {
    const pageNum = filter.pageNum || 1;
    const pageSize = filter.pageSize || 10;

    const [moduleList, total] = await this.moduleRepository.findAndCount({
      where: this.buildWhere(filter),
      skip: (pageNum - 1) * pageSize,
      take: pageSize,
    });

    return {
      list: moduleList as ModuleDto[],
      total,
      pageNum,
      pageSize,
    };
  }

  private buildWhere(filter: ModulePageFiltersDto): FindOptionsWhere<Module> {
    const where: FindOptionsWhere<Module> = {};

    // æ—¥æœŸèŒƒå›´æ¡ä»¶
    if (filter.planDateStart && filter.planDateEnd) {
      where.planDate = Between(
        new Date(filter.planDateStart + "T00:00:00"),
        new Date(filter.planDateEnd + "T23:59:59")
      );
    }

    // å…³é”®è¯æœç´¢
    if (filter.keyword) {
      where.name = Like(`%${filter.keyword}%`);
    }

    // çŠ¶æ€è¿‡æ»¤
    if (filter.status) {
      where.status = filter.status;
    }

    return where;
  }
}
```

#### 3.3 Repository Desktop å®ç°ï¼ˆSQLiteï¼‰
**ä½ç½®**: `apps/desktop/src/database/{domain}/{module}/*.repository.ts`

**æ ¸å¿ƒåŸåˆ™**:
- é€‚é… SQLite è½»é‡çº§æŸ¥è¯¢
- ä¼˜åŒ–æœ¬åœ°æ•°æ®è®¿é—®æ€§èƒ½
- æ”¯æŒç¦»çº¿æ•°æ®æ“ä½œ

**ç¤ºä¾‹ä»£ç **:
```typescript
// apps/desktop/src/database/{domain}/{module}/{module}.repository.ts
export class ModuleRepository {
  private repo: Repository<Module> = AppDataSource.getRepository(Module);

  private buildQuery(filter: ModuleListFilterDto) {
    const qb = this.repo
      .createQueryBuilder("module")
      .leftJoinAndSelect("module.parent", "parent");

    if (filter.status !== undefined) {
      qb.andWhere("module.status = :status", { status: filter.status });
    }
    if (filter.keyword) {
      qb.andWhere("module.name LIKE :kw", { kw: `%${filter.keyword}%` });
    }

    return qb;
  }

  async create(createDto: CreateModuleDto): Promise<ModuleDto> {
    const entity = this.repo.create({
      name: createDto.name,
      description: createDto.description,
      status: createDto.status ?? EntityStatus.ACTIVE,
      priority: createDto.priority,
      planDate: createDto.planDate,
    });

    const saved = await this.repo.save(entity);
    return ModuleDto.importEntity(saved);
  }

  async page(filter: ModulePageFiltersDto): Promise<{
    list: ModuleDto[];
    total: number;
    pageNum: number;
    pageSize: number;
  }> {
    const { pageNum = 1, pageSize = 10 } = filter;
    const qb = this.buildQuery(filter);

    const [list, total] = await qb
      .skip((pageNum - 1) * pageSize)
      .take(pageSize)
      .orderBy("module.createdAt", "DESC")
      .getManyAndCount();

    return {
      list: list.map((item) => ModuleDto.importEntity(item)),
      total,
      pageNum,
      pageSize,
    };
  }
}
```

#### 3.4 Service å®šä¹‰ï¼ˆä¸šåŠ¡æœåŠ¡ï¼‰
**ä½ç½®**: `packages/business/server/src/{domain}/{module}/*.service.ts`

**æ ¸å¿ƒåŸåˆ™**:
- å®ç°ä¸šåŠ¡è§„åˆ™å’Œé€»è¾‘å¤„ç†
- åè°ƒå¤šä¸ª Repository çš„æ“ä½œ
- å¤„ç†äº‹åŠ¡å’Œå¼‚å¸¸

**ç¤ºä¾‹ä»£ç **:
```typescript
// packages/business/server/src/{domain}/{module}/{module}.service.ts
export class ModuleService {
  protected moduleRepository: ModuleRepository;

  constructor(moduleRepository: ModuleRepository) {
    this.moduleRepository = moduleRepository;
  }

  async create(createDto: CreateModuleDto): Promise<ModuleDto> {
    // ä¸šåŠ¡è§„åˆ™éªŒè¯
    if (!createDto.name?.trim()) {
      throw new Error("æ¨¡å—åç§°ä¸èƒ½ä¸ºç©º");
    }

    // åˆ›å»ºæ¨¡å—
    const module = await this.moduleRepository.create(createDto);

    // è§¦å‘ç›¸å…³ä¸šåŠ¡é€»è¾‘
    // ...

    return module;
  }

  async process(id: string): Promise<ModuleDto> {
    // æŸ¥æ‰¾æ¨¡å—
    const module = await this.moduleRepository.findById(id);

    // ä¸šåŠ¡è§„åˆ™ï¼šåªæœ‰æ¿€æ´»çŠ¶æ€çš„æ¨¡å—æ‰èƒ½å¤„ç†
    if (module.status !== EntityStatus.ACTIVE) {
      throw new Error("åªæœ‰æ¿€æ´»çŠ¶æ€çš„æ¨¡å—æ‰èƒ½å¤„ç†");
    }

    // æ›´æ–°çŠ¶æ€
    const updateDto = new UpdateModuleDto();
    updateDto.status = EntityStatus.PROCESSED;
    updateDto.processedAt = new Date();

    return await this.moduleRepository.update(id, updateDto);
  }

  async page(filter: ModulePageFiltersDto): Promise<{
    list: ModuleDto[];
    total: number;
    pageNum: number;
    pageSize: number;
  }> {
    // ä¸šåŠ¡è§„åˆ™å¤„ç†
    if (filter.pageSize > 100) {
      filter.pageSize = 100; // é™åˆ¶æœ€å¤§åˆ†é¡µå¤§å°
    }

    return await this.moduleRepository.page(filter);
  }
}
```

### ç¬¬å››é˜¶æ®µï¼šæ§åˆ¶å™¨

#### 4.1 Business Controller å®šä¹‰ï¼ˆæ ¸å¿ƒä¸šåŠ¡æ§åˆ¶å™¨ï¼‰
**ä½ç½®**: `packages/business/server/src/{domain}/{module}/*.controller.ts`

**æ ¸å¿ƒåŸåˆ™**:
- å®ç°æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- å¤„ç† VO â†” DTO æ•°æ®è½¬æ¢
- ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†

**ç¤ºä¾‹ä»£ç **:
```typescript
// packages/business/server/src/{domain}/{module}/{module}.controller.ts
export class ModuleController {
  protected moduleService: ModuleService;

  constructor(moduleService: ModuleService) {
    this.moduleService = moduleService;
  }

  async create(createVo: ModuleVO.CreateModuleVo): Promise<ModuleVO.ModuleItemVo> {
    // VO â†’ DTO è½¬æ¢
    const createDto = CreateModuleDto.importVo(createVo);

    // è°ƒç”¨ä¸šåŠ¡æœåŠ¡
    const dto = await this.moduleService.create(createDto);

    // DTO â†’ VO è½¬æ¢
    return dto.exportVo();
  }

  async list(filter: ModuleVO.ModuleListFilterVo): Promise<ModuleVO.ModuleItemVo[]> {
    // VO â†’ DTO è½¬æ¢
    const filterDto = ModuleListFilterDto.importVo(filter);

    // è°ƒç”¨ä¸šåŠ¡æœåŠ¡
    const dtos = await this.moduleService.findByFilter(filterDto);

    // DTO â†’ VO è½¬æ¢
    return dtos.map(dto => dto.exportVo());
  }

  async process(id: string): Promise<ModuleVO.ModuleItemVo> {
    // è°ƒç”¨ä¸šåŠ¡æœåŠ¡
    const dto = await this.moduleService.process(id);

    // DTO â†’ VO è½¬æ¢
    return dto.exportVo();
  }
}
```

#### 4.2 Server Controller å®ç°ï¼ˆHTTP APIï¼‰
**ä½ç½®**: `apps/server/src/business/{domain}/{module}/*.controller.ts`

**æ ¸å¿ƒåŸåˆ™**:
- æä¾› HTTP REST API æ¥å£
- å¤„ç† HTTP è¯·æ±‚å’Œå“åº”
- å‚æ•°éªŒè¯å’Œè·¯ç”±å®šä¹‰

**ç¤ºä¾‹ä»£ç **:
```typescript
// apps/server/src/business/{domain}/{module}/{module}.controller.ts
@Controller("{module}")
export class ModuleServerController {
  constructor(
    private readonly moduleController: ModuleController
  ) {}

  @Post("create")
  async create(@Body() createVo: ModuleVO.CreateModuleVo): Promise<ModuleVO.ModuleItemVo> {
    return await this.moduleController.create(createVo);
  }

  @Get("list")
  async list(@Query() filter: ModuleVO.ModuleListFilterVo): Promise<ModuleVO.ModuleItemVo[]> {
    return await this.moduleController.list(filter);
  }

  @Put(":id/process")
  async process(@Param("id") id: string): Promise<ModuleVO.ModuleItemVo> {
    return await this.moduleController.process(id);
  }

  @Get("page")
  async page(@Query() filter: ModuleVO.ModulePageFilterVo): Promise<ModuleVO.ModulePageResultVo> {
    // è°ƒç”¨æ ¸å¿ƒä¸šåŠ¡æ§åˆ¶å™¨
    const result = await this.moduleController.page(filter);

    // è½¬æ¢åˆ†é¡µç»“æœ
    return {
      list: result.list,
      total: result.total,
      pageNum: result.pageNum,
      pageSize: result.pageSize,
    };
  }
}
```

#### 4.3 Desktop Controller å®ç°ï¼ˆIPC æ¥å£ï¼‰
**ä½ç½®**: `apps/desktop/src/database/growth/{module}.controller.ts`

**æ ¸å¿ƒåŸåˆ™**:
- æä¾› IPC å¼‚æ­¥æ¥å£
- å¤„ç† Electron ä¸»è¿›ç¨‹é€šä¿¡
- é€‚é…æ¡Œé¢ç«¯æ•°æ®æ“ä½œ

**ç¤ºä¾‹ä»£ç **:
```typescript
// apps/desktop/src/database/{domain}/{module}/{module}.controller.ts
export class ModuleDesktopController {
  constructor(
    private readonly moduleController: ModuleController
  ) {}

  async create(createVo: ModuleVO.CreateModuleVo): Promise<ModuleVO.ModuleItemVo> {
    return await this.moduleController.create(createVo);
  }

  async list(filter: ModuleVO.ModuleListFilterVo): Promise<ModuleVO.ModuleItemVo[]> {
    return await this.moduleController.list(filter);
  }

  async process(id: string): Promise<ModuleVO.ModuleItemVo> {
    return await this.moduleController.process(id);
  }
}

// IPC å¤„ç†å™¨æ³¨å†Œ
export function registerModuleIpcHandlers(moduleController: ModuleDesktopController) {
  ipcMain.handle("{module}:create", async (event, createVo) => {
    return await moduleController.create(createVo);
  });

  ipcMain.handle("{module}:list", async (event, filter) => {
    return await moduleController.list(filter);
  });

  ipcMain.handle("{module}:process", async (event, id) => {
    return await moduleController.process(id);
  });
}
```

### ç¬¬äº”é˜¶æ®µï¼šå­—æ®µæ§åˆ¶

#### 5.1 å­—æ®µæµè½¬ç®¡ç†
**å‚è€ƒ**: [`field-manage.mdc`](./field-manage.mdc)

**æ ¸å¿ƒåŸåˆ™**:
- ç¡®ä¿å­—æ®µåœ¨å„å±‚çº§çš„å®šä¹‰ä¸€è‡´æ€§
- æä¾›å®Œæ•´çš„å­—æ®µå˜æ›´å®æ–½è·¯å¾„
- éªŒè¯å­—æ®µæµè½¬çš„å®Œæ•´æ€§

#### 5.2 ç­›é€‰åŠŸèƒ½ç®¡ç†
**å‚è€ƒ**: [`field-filter-manage.mdc`](./field-filter-manage.mdc)

**æ ¸å¿ƒåŸåˆ™**:
- æ”¯æŒçµæ´»çš„ç­›é€‰æ“ä½œç¬¦
- ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
- ç¡®ä¿ç­›é€‰åŠŸèƒ½çš„å®‰å…¨æ€§

## ğŸ”„ å®Œæ•´æµç¨‹éªŒè¯

### å¼€å‘æµç¨‹æ£€æŸ¥æ¸…å•

#### 1. æ•°æ®æ ¼å¼å®šä¹‰éªŒè¯
- [ ] Entity å­—æ®µå®šä¹‰å®Œæ•´ä¸”è§„èŒƒ
- [ ] DTO éªŒè¯è§„åˆ™æ­£ç¡®é…ç½®
- [ ] VO ä¸åç«¯æ•°æ®ç»“æ„å¯¹åº”
- [ ] æšä¸¾å€¼åœ¨å„å±‚çº§ä¿æŒä¸€è‡´

#### 2. æ•°æ®è½¬æ¢éªŒè¯
- [ ] DTO å†…ç½®æ–¹æ³•å®ç° Entity â†” DTO åŒå‘è½¬æ¢
- [ ] æ—¥æœŸæ ¼å¼æ­£ç¡®å¤„ç†
- [ ] æšä¸¾å€¼æ­£ç¡®æ˜ å°„
- [ ] å…³è”å…³ç³»æ­£ç¡®å¤„ç†

#### 3. ä¸šåŠ¡é€»è¾‘éªŒè¯
- [ ] Repository Interface å®šä¹‰å®Œæ•´
- [ ] Server Repository å®ç° TypeORM è§„èŒƒ
- [ ] Desktop Repository é€‚é… SQLite ä¼˜åŒ–
- [ ] Service å®ç°ä¸šåŠ¡è§„åˆ™æ­£ç¡®

#### 4. æ§åˆ¶å™¨éªŒè¯
- [ ] Business Controller å¤„ç† VO â†” DTO è½¬æ¢
- [ ] Server Controller æä¾› HTTP REST API
- [ ] Desktop Controller æä¾› IPC å¼‚æ­¥æ¥å£
- [ ] å¼‚å¸¸å¤„ç†æœºåˆ¶å®Œå–„

#### 5. å­—æ®µæ§åˆ¶éªŒè¯
- [ ] å­—æ®µåœ¨å„å±‚çº§å®šä¹‰ä¸€è‡´
- [ ] ç­›é€‰åŠŸèƒ½æ“ä½œç¬¦æ”¯æŒå®Œæ•´
- [ ] æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–åˆ°ä½
- [ ] æ€§èƒ½å’Œå®‰å…¨éªŒè¯é€šè¿‡

## ğŸ“Š æ¶æ„ä¼˜åŠ¿

### 1. åˆ†å±‚æ¸…æ™°
- **æ•°æ®å±‚**: Entity/DTO/VO ä¸“æ³¨äºæ•°æ®å®šä¹‰å’Œè½¬æ¢
- **ä¸šåŠ¡å±‚**: Repository/Service ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å®ç°
- **æ§åˆ¶å±‚**: Controller ä¸“æ³¨äºæ¥å£é€‚é…å’Œè¯·æ±‚å¤„ç†

### 2. è·¨å¹³å°æ”¯æŒ
- **Business Layer**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å¹³å°æ— å…³
- **Adapter Layer**: Server/Desktop åˆ†åˆ«é€‚é…ä¸åŒå¹³å°
- **ç»Ÿä¸€æ¥å£**: é€šè¿‡ VO ä¿æŒå‰åç«¯æ¥å£ä¸€è‡´æ€§

### 3. å¼€å‘æ•ˆç‡
- **ä»£ç å¤ç”¨**: æ ¸å¿ƒé€»è¾‘å¯ä»¥è¢«å¤šä¸ªå¹³å°å…±äº«
- **å¹¶è¡Œå¼€å‘**: å„å±‚çº§å¯ä»¥ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•
- **ç»´æŠ¤ä¾¿åˆ©**: é—®é¢˜å®šä½å’Œä¿®å¤æ›´åŠ ç²¾å‡†

### 4. å¯æ‰©å±•æ€§
- **æ–°å¹³å°æ”¯æŒ**: åªéœ€å¼€å‘å¯¹åº”çš„ Adapter å±‚
- **åŠŸèƒ½æ‰©å±•**: åœ¨å¯¹åº”å±‚çº§æ·»åŠ æ–°åŠŸèƒ½å½±å“æœ€å°
- **ç‰ˆæœ¬æ¼”è¿›**: å„å±‚çº§å¯ä»¥ç‹¬ç«‹æ¼”è¿›å’Œéƒ¨ç½²

## ğŸ“š ç›¸å…³è§„èŒƒæ–‡æ¡£

- **[`entity.mdc`](./entity.mdc)** - Entity è§„èŒƒï¼ˆæ•°æ®æ¨¡å‹å®šä¹‰ï¼‰
- **[`dto.mdc`](./dto.mdc)** - DTO è§„èŒƒï¼ˆæ•°æ®ä¼ è¾“å¯¹è±¡ï¼‰
- **[`vo.mdc`](./vo.mdc)** - VO è§„èŒƒï¼ˆå€¼å¯¹è±¡ï¼‰
- **[`repository.mdc`](./repository.mdc)** - Repository è§„èŒƒæ€»è§ˆ
- **[`service.mdc`](./service.mdc)** - Service è§„èŒƒï¼ˆä¸šåŠ¡æœåŠ¡ï¼‰
- **[`controller.mdc`](./controller.mdc)** - Controller è§„èŒƒæ€»è§ˆ
- **[`field-manage.mdc`](./field-manage.mdc)** - å­—æ®µæµè½¬ç®¡ç†
- **[`field-filter-manage.mdc`](./field-filter-manage.mdc)** - ç­›é€‰åŠŸèƒ½ç®¡ç†

## ğŸ¯ æœ€ä½³å®è·µ

### 1. å¼€å‘é¡ºåº
1. **æ•°æ®æ ¼å¼å®šä¹‰** - Entity/DTO/VO
2. **ä¸šåŠ¡é€»è¾‘å®ç°** - Repository/Service
3. **æ§åˆ¶å™¨å¼€å‘** - Business/Server/Desktop Controller
4. **å­—æ®µæ§åˆ¶** - å­—æ®µç®¡ç†å’Œç­›é€‰åŠŸèƒ½

### 2. ä»£ç è§„èŒƒ
- éµå¾ª TypeScript ä¸¥æ ¼æ¨¡å¼
- ä½¿ç”¨ ESLint å’Œ Prettier ç»Ÿä¸€ä»£ç é£æ ¼
- ç¼–å†™å®Œæ•´çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

### 3. æ–‡æ¡£ç»´æŠ¤
- åŠæ—¶æ›´æ–° API æ–‡æ¡£
- ä¿æŒä»£ç æ³¨é‡Šçš„å‡†ç¡®æ€§å’Œå®Œæ•´æ€§
- è®°å½•é‡è¦çš„è®¾è®¡å†³ç­–å’Œæƒè¡¡è€ƒè™‘

### 4. è´¨é‡ä¿è¯
- å®æ–½ Code Review æµç¨‹
- è‡ªåŠ¨åŒ–æµ‹è¯•è¦†ç›–æ ¸å¿ƒåŠŸèƒ½
- æ€§èƒ½ç›‘æ§å’Œé”™è¯¯è¿½è¸ª

---

*æ­¤æ–‡æ¡£ä¸º Life Toolkit å®Œæ•´å¼€å‘æµç¨‹è§„èŒƒæ€»è§ˆï¼Œç¡®ä¿ä»æ•°æ®å®šä¹‰åˆ°æ§åˆ¶å™¨å®ç°çš„å„ä¸ªç¯èŠ‚è§„èŒƒç»Ÿä¸€ã€æµç¨‹è¿è´¯ã€‚* 

