# 习惯管理模块 - 产品需求文档(PRD)

## 一、产品概述

```yaml
product_meta:
  name: "习惯管理模块"
  version: "v1.0"
  priority: "high"
  complexity: "complex"
  estimated_effort: "2-4周"
  business_value: "通过科学的习惯追踪与统计分析，帮助用户建立良好习惯，提升自我管理能力"
  target_users: ["自我提升爱好者", "健康生活追求者", "职场人士", "学生群体"]
  related_features: ["目标管理", "待办事项", "时间追踪", "AI助手"]
  tags: ["个人成长", "习惯养成", "生活管理", "数据分析"]
```

### 功能目标

解决用户目标实现缺乏具体行动支撑的问题 + 提供围绕目标的习惯养成体系 + 面向目标导向的个人成长用户

### 核心里念

习惯管理模块基于"**目标驱动习惯，习惯支撑目标**"的核心理念设计：

- **目标为导向**: 习惯的建立围绕用户的具体目标展开
- **习惯为手段**: 通过日常习惯的养成来逐步实现长期目标
- **系统性关联**: 建立目标与习惯之间的有机联系和相互促进关系

### 用户场景

- **主场景**: 用户为实现特定目标而建立和维持相关习惯
- **次场景**: 健康目标的运动饮食习惯、学习目标的阅读练习习惯、职业目标的技能提升习惯
- **边界场景**: 无目标导向的随意习惯(弱化)、团队习惯管理(排除)、医疗级健康监控(排除)

### 功能范围

✅ **包含**: 目标导向的习惯创建、习惯状态管理、目标进度贡献追踪、目标-习惯关联分析、待办集成
❌ **排除**: 独立于目标的习惯管理、社交分享、团队协作、医疗建议、硬件设备集成

## 二、需求分析

### 核心用户故事

```gherkin
Feature: 目标导向的习惯管理
  As a 目标导向的个人用户
  I want 围绕我的目标创建和追踪相关习惯
  So that 我可以通过日常习惯的养成来逐步实现我的长期目标

Scenario: 基于目标创建习惯
  Given 用户已进入系统
  And 用户有一个目标"提升专业技能"
  And 用户在目标详情页面
  When 用户点击"添加支撑习惯"按钮
  And 填写习惯名称"每日技术学习1小时"
  And 设置重要程度为"5"
  And 选择难度等级为"4"
  And 添加标签"学习,技能,成长"
  And 设置开始日期为"今天"
  And 设置对目标的贡献权重为"8"
  And 点击保存按钮
  Then 系统应该创建新的习惯记录
  And 习惯自动关联到"提升专业技能"目标
  And 显示创建成功提示
  And 习惯出现在目标的支撑习惯列表中
  And 自动生成今日相关待办事项

Scenario: 从习惯页面关联目标
  Given 用户已进入系统
  And 用户在习惯管理页面
  When 用户点击"创建习惯"按钮
  And 填写习惯名称"每日阅读30分钟"
  And 设置重要程度为"4"
  And 选择难度等级为"3"
  And 添加标签"学习,成长"
  And 设置开始日期为"今天"
  And 选择关联目标"知识体系构建"
  And 设置对目标的贡献权重为"6"
  And 点击保存按钮
  Then 系统应该创建新的习惯记录
  And 显示创建成功提示
  And 习惯出现在活跃习惯列表中
  And 习惯关联到指定目标
  And 自动生成今日相关待办事项

Scenario: 标记习惯完成并推进目标
  Given 用户有一个活跃状态的习惯"每日技术学习1小时"
  And 该习惯关联到目标"提升专业技能"
  And 今日该习惯尚未完成
  When 用户点击习惯的"完成"按钮
  Then 习惯状态更新为今日已完成
  And 连续天数增加1天
  And 完成次数增加1次
  And 关联的待办事项自动标记完成
  And 根据贡献权重更新目标"提升专业技能"的进度
  And 显示完成确认动画
  And 显示对目标进度的贡献提示

Scenario: 查看习惯统计
  Given 用户有多个习惯记录
  And 习惯已执行一段时间
  When 用户点击"统计分析"页面
  Then 系统应该显示整体完成率
  And 显示各习惯的连续天数
  And 显示完成率趋势图表
  And 显示习惯分类统计
  And 提供改进建议

Scenario: 暂停习惯
  Given 用户有一个活跃状态的习惯
  When 用户选择"暂停习惯"操作
  And 确认暂停操作
  Then 习惯状态变更为"已暂停"
  And 保存当前进度数据
  And 停止生成相关待办事项
  And 显示暂停成功提示

Scenario: 放弃习惯
  Given 用户有一个活跃或暂停状态的习惯
  When 用户选择"放弃习惯"操作
  And 确认放弃操作
  Then 习惯状态变更为"已放弃"
  And 记录放弃时间
  And 保留历史数据
  And 停止所有相关自动化操作

Scenario: 目标驱动的习惯建议
  Given 用户有一个目标"减重10公斤"
  And 该目标当前进度较慢
  When 用户在目标详情页查看建议
  Then 系统应该分析目标类型
  And 推荐相关的支撑习惯
  And 显示"建议添加习惯: 每日运动30分钟"
  And 显示"建议添加习惯: 控制饮食热量"
  And 提供一键创建习惯的快捷操作
  And 预设合理的贡献权重

Scenario: 查看目标的习惯贡献分析
  Given 用户有目标"提升英语水平"
  And 该目标关联了3个习惯
  When 用户在目标详情页查看贡献分析
  Then 系统应该显示每个习惯的贡献度
  And 显示"每日背单词"贡献40%
  And 显示"每日听力练习"贡献35%
  And 显示"每周口语练习"贡献25%
  And 显示各习惯的执行情况对比
  And 提供优化建议
```

### 业务流程

#### 目标驱动的习惯建立流程

```
设定目标 → 分析目标需求 → 识别支撑习惯 → 创建相关习惯 → 设置贡献权重 → 开始执行
```

#### 习惯执行与目标推进流程

```
查看目标进度 → 执行支撑习惯 → 标记习惯完成 → 自动更新目标进度 → 查看贡献分析 → 优化习惯策略
```

#### 完整的目标-习惯管理流程

```
目标规划 → 习惯设计 → 关联配置 → 日常执行 → 进度追踪 → 效果分析 → 策略调整 → 目标达成
```

### 业务规则

#### 权限规则

- 用户仅能管理自己的习惯数据
- 无多租户或角色权限控制 
- 管理员可查看系统整体统计数据(匿名化)
- 游客用户需要登录后才能使用功能

#### 数据规则

- 习惯名称: 必填，1-50字符
- 描述: 可选，最多200字符
- 重要程度: 1-5级，默认为3
- 难度等级: 1-5级，默认为3
- 标签: 可选，最多5个标签
- 开始日期: 必填，不能早于当前日期
- 目标日期: 可选，必须晚于开始日期，不选为长期

#### 状态规则

- 初始状态: 活跃中(active)
- 状态转换: 活跃 ↔ 暂停 ↔ 放弃，活跃 → 完成
- 完成条件: 达到目标日期且保持良好执行率
- 重新激活: 暂停和放弃的习惯可以重新激活

#### 统计规则

- 连续天数: 从最近一次中断开始计算
- 完成率: 已完成天数 / 总天数
- 最长连续: 历史最长连续执行天数
- 数据保留: 放弃的习惯保留历史数据

## 三、产品设计

### 目标导向的习惯创建功能

**业务目标**:

- 解决用户目标缺乏具体行动支撑的问题
- 为用户提供围绕目标的习惯设计能力
- 建立目标与支撑习惯的强关联关系

**功能描述**:

- **目标选择**: 优先选择要支撑的目标(必选)
- **习惯设计**: 基于目标需求设计相应的习惯行为
- **基础信息**: 习惯名称、描述、标签分类
- **属性设置**: 重要程度(1-5级)、难度等级(1-5级)
- **贡献权重**: 设置该习惯对目标的贡献权重(1-10级)
- **时间规划**: 开始日期、目标完成日期
- **智能建议**: 根据目标类型推荐相关习惯模板

**两种创建路径**:

#### 路径一: 从目标页面创建支撑习惯

1. 用户在目标详情页点击"添加支撑习惯"
2. 系统自动关联当前目标
3. 填写习惯基础信息
4. 设置对当前目标的贡献权重
5. 完成创建，习惯自动归属到目标下

#### 路径二: 从习惯页面创建并关联目标

1. 用户点击"创建习惯"按钮
2. **强制选择**要支撑的目标(至少一个)
3. 填写习惯基础信息
4. 设置重要程度和难度等级
5. 为每个关联目标设置贡献权重
6. 完成创建，建立目标-习惯关联

**业务规则**:

<!-- - 权限规则: 登录用户可创建习惯 -->
- 数据规则: 名称唯一性检查，字符长度限制
- **强制关联规则**: 每个习惯必须关联至少一个活跃目标
- 权重规则: 贡献权重为1-10级，默认为5
- 目标有效性: 关联的目标必须存在、属于当前用户且状态为活跃

**异常处理**:

- 名称重复: 提示"该习惯名称已存在，请使用其他名称"
- 网络异常: 提示"保存失败，请检查网络连接后重试"
- 目标不存在: 提示"选择的目标不存在，请重新选择"

### 习惯状态管理功能

**业务目标**:

- 解决习惯执行状态追踪不准确的问题
- 为用户提供灵活的状态管理能力
- 支持习惯生命周期的完整管理

**功能描述**:

- **状态标记**: 支持完成、暂停、恢复、放弃操作
- **批量操作**: 支持多个习惯的批量状态更新
- **自动化**: 根据规则自动更新状态和生成待办
- **历史记录**: 完整记录状态变更历史
- **智能提醒**: 基于执行模式的智能提醒

**用户操作流程**:

1. 用户查看今日习惯列表
2. 选择要操作的习惯
3. 点击相应的状态操作按钮
4. 确认操作(如需要)
5. 系统更新状态和相关数据
6. 显示操作结果反馈

**业务规则**:

- 权限规则: 用户只能操作自己的习惯
- 状态规则: 遵循预定义的状态转换规则
- 时间规则: 每日只能标记一次完成
- 数据规则: 状态变更需记录时间戳

**异常处理**:

- 重复操作: 提示"今日已完成该习惯"
- 状态冲突: 提示"当前状态不支持此操作"
- 数据异常: 提示"操作失败，请刷新页面后重试"

### 进度追踪与统计功能

**业务目标**:

- 解决用户缺乏习惯执行反馈的问题
- 为用户提供数据驱动的改进建议
- 建立习惯与目标进度的可视化关联

**功能描述**:

- **实时统计**: 连续天数、完成次数、完成率
- **趋势分析**: 周、月、年度完成率趋势
- **对比分析**: 不同习惯间的执行效果对比
- **目标贡献**: 习惯对目标达成的贡献度分析
- **改进建议**: 基于数据的个性化建议

**用户操作流程**:

1. 用户进入统计分析页面
2. 选择查看时间范围
3. 选择要分析的习惯
4. 查看各类统计图表
5. 阅读系统生成的分析报告
6. 根据建议调整习惯策略

**业务规则**:

- 数据规则: 统计数据实时计算，缓存优化
- 时间规则: 支持日、周、月、年多维度统计
- 精度规则: 百分比保留两位小数
- 展示规则: 数据可视化遵循用户体验最佳实践

**异常处理**:

- 数据为空: 显示"暂无数据，开始记录习惯吧"
- 计算错误: 提示"统计数据异常，请联系客服"
- 加载超时: 提示"数据加载中，请稍候"

### 目标-习惯关联与进度同步功能

**业务目标**:

- 建立目标与习惯之间的强关联关系
- 实现习惯执行对目标进度的实时贡献
- 提供目标导向的习惯管理体验

**核心设计理念**:

- **目标为中心**: 所有习惯都围绕目标展开
- **量化贡献**: 每个习惯对目标的贡献可量化计算
- **实时同步**: 习惯完成立即反映到目标进度
- **多维支撑**: 一个目标可由多个习惯共同支撑

**功能描述**:

- **强制关联**: 每个习惯必须关联至少一个目标
- **多目标支撑**: 一个习惯可以同时支撑多个相关目标
- **权重配置**: 为每个关联设置贡献权重(1-10级)
- **进度计算**: 基于权重自动计算目标进度
- **实时同步**: 习惯状态变更立即更新目标进度
- **关联分析**: 分析习惯对目标达成的贡献效果

**目标进度计算公式**:

```
目标进度 = Σ(习惯完成率 × 贡献权重) / Σ贡献权重
```

**用户操作流程**:

#### 查看目标的支撑习惯

1. 用户进入目标详情页
2. 查看"支撑习惯"列表
3. 查看每个习惯的执行情况和贡献度
4. 点击习惯可进入习惯详情

#### 管理习惯的目标关联

1. 用户进入习惯详情页
2. 查看"关联目标"列表
3. 调整贡献权重或添加新的目标关联
4. 查看该习惯对各目标的贡献分析

#### 目标-习惯联动分析

1. 用户查看目标进度异常
2. 系统分析相关习惯的执行情况
3. 识别影响目标进度的关键习惯
4. 提供针对性的改进建议

**业务规则**:

- **强制关联**: 创建习惯时必须选择至少一个目标
- **目标有效性**: 关联的目标必须存在、属于当前用户且状态为活跃
- **权重范围**: 贡献权重为1-10级，默认为5
- **进度计算**: 目标进度实时计算，精确到小数点后两位
- **同步规则**: 习惯状态变更时立即更新所有关联目标的进度
- **关联上限**: 一个习惯最多可关联5个目标

**异常处理**:

- 目标不存在: 提示"目标已被删除，请重新选择"
- 重复关联: 提示"该目标已关联，无需重复操作"
- 权重异常: 提示"权重值必须在1-10之间"

### 界面设计规范

**功能布局**:

- **顶部导航**: 习惯列表、统计分析、设置
- **主体区域**: 习惯卡片列表/统计图表
- **侧边栏**: 筛选器、快捷操作
- **底部**: 创建按钮、分页器

**交互规范**:

- **点击完成**: 直接标记完成，显示动画反馈
- **长按操作**: 显示操作菜单(编辑、删除、暂停等)
- **拖拽排序**: 支持习惯优先级调整
- **下拉刷新**: 更新最新数据
- **无限滚动**: 大量数据的分页加载

**视觉规范**:

- **状态标识**: 不同颜色表示不同状态
- **进度指示**: 进度条、环形图显示完成度
- **数据可视化**: 图表清晰、色彩友好
- **响应式**: 适配不同屏幕尺寸

**权限控制**:

- **查看权限**: 用户只能查看自己的习惯数据
- **操作权限**: 用户只能操作自己创建的习惯
- **管理权限**: 管理员可查看系统统计(匿名化)
- **导出权限**: 用户可导出自己的习惯数据

## 四、验收标准

### 功能验收测试

```gherkin
Scenario Outline: 习惯管理功能验收
  Given 用户角色是 "<role>"
  And 系统中有 "<existing_count>" 个习惯
  When 用户执行 "<action>" 操作
  And 输入数据是 "<input_data>"
  Then 系统应该显示 "<expected_result>"
  And 业务状态变更为 "<final_state>"

Examples:
  | role | existing_count | action | input_data | expected_result | final_state |
  | 用户 | 0 | 创建习惯 | 名称:"每日阅读",重要性:4 | 创建成功提示 | 有1个活跃习惯 |
  | 用户 | 1 | 标记完成 | 点击完成按钮 | 完成动画,连续天数+1 | 今日已完成 |
  | 用户 | 1 | 暂停习惯 | 点击暂停按钮 | 暂停确认提示 | 习惯状态为暂停 |
  | 用户 | 1 | 查看统计 | 点击统计页面 | 显示完成率图表 | 统计数据正确 |

Scenario Outline: 习惯状态管理验收
  Given 习惯当前状态是 "<current_status>"
  When 用户执行 "<action>" 操作
  Then 习惯状态应该变更为 "<new_status>"
  And 系统应该 "<system_action>"

Examples:
  | current_status | action | new_status | system_action |
  | active | 标记完成 | active | 更新完成记录,增加连续天数 |
  | active | 暂停 | paused | 保存当前进度,停止生成待办 |
  | paused | 恢复 | active | 重新开始生成待办事项 |
  | active | 放弃 | abandoned | 记录放弃时间,保留历史数据 |
  | abandoned | 重新激活 | active | 重置为活跃状态 |

Scenario Outline: 数据统计验收
  Given 用户有习惯 "<habit_name>"
  And 执行了 "<completed_days>" 天
  And 总共 "<total_days>" 天
  When 用户查看统计数据
  Then 完成率应该是 "<completion_rate>"
  And 连续天数应该是 "<streak_days>"

Examples:
  | habit_name | completed_days | total_days | completion_rate | streak_days |
  | 每日阅读 | 7 | 10 | 70% | 3 |
  | 晨练 | 15 | 15 | 100% | 15 |
  | 早睡 | 5 | 20 | 25% | 0 |

Scenario Outline: 目标-习惯关联验收
  Given 用户有目标 "<goal_name>"
  And 目标关联了习惯 "<habit_name>"
  And 习惯的贡献权重是 "<weight>"
  And 习惯完成率是 "<completion_rate>"
  When 系统计算目标进度
  Then 该习惯对目标的贡献应该是 "<contribution>"
  And 目标整体进度应该正确计算

Examples:
  | goal_name | habit_name | weight | completion_rate | contribution |
  | 健康生活 | 每日运动 | 8 | 80% | 64% |
  | 技能提升 | 每日学习 | 6 | 90% | 54% |
  | 知识积累 | 每日阅读 | 5 | 70% | 35% |

Scenario Outline: 目标进度同步验收
  Given 目标 "<goal_name>" 有多个支撑习惯
  And 各习惯的权重和完成率如下
  When 用户完成其中一个习惯
  Then 目标进度应该实时更新
  And 进度计算应该准确

Examples:
  | goal_name | habit1_weight | habit1_rate | habit2_weight | habit2_rate | expected_progress |
  | 学习目标 | 6 | 80% | 4 | 60% | 72% |
  | 健康目标 | 8 | 90% | 2 | 50% | 82% |
```

### 业务验收标准

**功能完整性**:

- ✅ 支持目标导向的习惯完整生命周期管理(目标分析→习惯创建→执行追踪→目标推进)
- ✅ 强制实现习惯与目标的关联，确保每个习惯都有明确的目标支撑
- ✅ 提供准确的进度追踪和目标贡献分析
- ✅ 实现习惯执行对目标进度的实时同步更新
- ✅ 支持基于目标的习惯建议和优化
- ✅ 支持待办事项的自动生成和同步

**目标-习惯关联准确性**:

- ✅ 习惯创建时强制关联目标，无法创建独立习惯
- ✅ 目标进度计算基于权重公式准确计算
- ✅ 习惯完成立即同步更新所有关联目标进度
- ✅ 贡献权重设置和调整功能正常
- ✅ 目标-习惯关联关系数据一致性保障

**数据准确性**:

- ✅ 连续天数计算准确，中断后重新计算
- ✅ 完成率统计精确到小数点后两位
- ✅ 状态变更时间戳记录准确
- ✅ 目标进度同步计算精确，支持多习惯权重计算
- ✅ 习惯对目标的贡献度计算准确

**性能要求**:

- ✅ 页面加载时间 < 2秒
- ✅ 状态操作响应时间 < 1秒
- ✅ 统计数据计算时间 < 3秒
- ✅ 支持100+习惯的并发管理

**用户体验**:

- ✅ 操作流程直观，新用户5分钟内上手
- ✅ 状态反馈及时，操作结果清晰可见
- ✅ 错误提示友好，引导用户正确操作
- ✅ 界面响应式，适配移动端和桌面端

### 边界条件测试

**数据边界**:

- 习惯名称长度: 1字符(最小) - 50字符(最大)
- 描述长度: 0字符(可选) - 200字符(最大)
- 重要程度: 1(最低) - 5(最高)
- 标签数量: 0个(可选) - 5个(最大)

**时间边界**:

- 开始日期: 不能早于当前日期
- 目标日期: 必须晚于开始日期
- 连续天数: 最大值为实际执行天数
- 统计时间范围: 支持最长1年的数据查询

**状态边界**:

- 每日完成标记: 每个习惯每天只能标记一次
- 状态转换: 严格按照预定义规则执行
- 并发操作: 防止同一习惯的并发状态修改
- 数据一致性: 确保习惯、目标、待办数据同步

## 五、产品价值与成功指标

### 业务价值

- **用户价值**: 通过目标导向的习惯管理，显著提高目标达成率和个人成长效果
- **产品价值**: 建立目标-习惯-行动的完整闭环，增强用户粘性和平台价值
- **数据价值**: 积累目标与习惯关联的行为数据，为AI个性化建议提供基础
- **差异化价值**: 区别于传统习惯管理工具，提供目标驱动的系统性解决方案

### 成功指标

- **功能指标**:
  - 习惯创建成功率 > 95%，且100%关联目标
  - 目标进度同步准确率 > 99%
  - 状态操作成功率 > 99%
- **用户指标**:
  - 日活跃用户使用率 > 60%
  - 用户留存率 > 80%
  - 目标-习惯关联使用率 > 90%
- **业务指标**:
  - 目标达成率提升 > 40%(相比无习惯支撑的目标)
  - 习惯坚持率提升 > 35%(相比无目标关联的习惯)
  - 用户目标完成时间缩短 > 25%

### 风险控制

- **技术风险**: 数据一致性保障，性能优化，异常处理
- **产品风险**: 功能复杂度控制，用户学习成本管理
- **业务风险**: 用户需求变化，竞品功能对比

## 六、后续迭代规划

### 短期优化 (1-2个月)

- 习惯提醒通知系统
- 数据导出功能
- 移动端体验优化
- 习惯模板库

### 中期扩展 (3-6个月)

- AI智能建议系统
- 社交分享功能
- 游戏化激励机制
- 高级统计分析

### 长期愿景 (6-12个月)

- 智能习惯教练
- 健康设备集成
- 专业指导服务
- 企业版本开发
