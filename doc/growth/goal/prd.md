# 目标管理（Goal）功能 PRD

## 一、产品概述
```yaml
product_meta:
  name: "目标管理（Goal）"
  version: "v1.0"
  priority: "high"
  complexity: "medium"
  estimated_effort: "1-2周"
  business_value: "帮助用户进行目标规划与拆解，配合任务联动，提升个人成长与执行效率"
  target_users: ["个人用户", "知识工作者"]
  related_features: ["任务管理", "习惯追踪"]
  tags: ["个人成长", "目标管理", "效率工具"]
```

**功能目标**:
- 解决目标缺乏结构化、难以拆解与跟踪的问题
- 提供列表 + 思维导图两种视图，提高浏览与管理效率
- 面向个人效率用户，支撑目标的创建、编辑、筛选、层级管理与状态流转

**用户场景**:
- 主场景: 用户按重要程度与时间窗口规划年度/季度/月度目标，管理进度与完成状态
- 次场景: 以树形方式梳理 KR（关键结果），可快速查阅子目标结构
- 边界场景: 团队协作、多人共享、目标评论/附件（当前不在范围）

**功能范围**:
- ✅ 包含: 目标 CRUD、树形层级、列表筛选（关键字/类型/状态/时间范围/重要程度）、状态操作（完成/放弃/恢复）、思维导图展示
- ❌ 排除: 标签系统、提醒通知、导入导出、统计分析（后续规划）

## 二、需求分析
```gherkin
Feature: 目标管理
  As a 个人用户
  I want 管理目标（创建/编辑/筛选/层级/状态流转）
  So that 我能高效规划与追踪个人目标

Scenario: 创建目标
  Given 用户在目标列表页面
  When 用户点击“新建”并填写名称、重要程度、类型与计划时间范围
  Then 系统应创建目标并提示成功
  And 列表自动刷新显示新目标

Scenario: 编辑目标
  Given 列表中存在一个目标
  When 用户点击“编辑”并更新字段
  Then 系统保存修改并提示成功
  And 列表刷新显示最新数据

Scenario: 删除目标（含子目标级联）
  Given 目标可能包含子目标
  When 用户点击“删除”并确认
  Then 系统删除该目标及其子目标
  And 列表刷新且不再显示该目标

Scenario: 标记完成
  Given 目标状态为 TODO 或 IN_PROGRESS
  When 用户执行“标记完成”
  Then 状态变更为 DONE 且记录 doneAt 时间

Scenario: 放弃目标
  Given 目标当前状态不是 ABANDONED
  When 用户执行“放弃”
  Then 状态变更为 ABANDONED 且记录 abandonedAt 时间

Scenario: 恢复目标
  Given 目标当前状态为 ABANDONED
  When 用户执行“恢复”
  Then 状态变更为 TODO

Scenario: 列表筛选
  Given 列表存在多条目标
  When 用户设置关键字、时间范围、类型、状态、重要程度任意组合
  Then 系统返回过滤后的结果

Scenario: 展开子目标
  Given 某一行目标存在子目标
  When 用户展开该行
  Then 系统拉取详情并展示子目标

Scenario: 思维导图展示
  Given 系统存在目标树
  When 用户进入“思维导图”页
  Then 系统加载树并以脑图展示
  And 节点点击可回调（预留逻辑）
```

**业务流程**:
- 列表视图: 进入页面 → 设置筛选条件 → 查询 → 展示表格 → 展开子目标 → 执行编辑/删除/状态操作
- 导图视图: 进入页面 → 加载数据 → 渲染思维导图 → 节点交互（点击/后续可扩展）

**业务规则**:
- 状态机:
  - 完成: 仅 `TODO`/`IN_PROGRESS` → `DONE`，并设置 `doneAt`
  - 放弃: 任意非 `ABANDONED` → `ABANDONED`，并设置 `abandonedAt`
  - 恢复: 仅 `ABANDONED` → `TODO`
- 数据规则:
  - 必填: `name`
  - 可选: `type`、`startAt`、`endAt`、`description`、`importance`、`status`、`parentId`
  - 计划时间: 若同时填写，需满足 `startAt <= endAt`
  - 删除: 树级联删除（`deleteWithTree`）
- 筛选规则:
  - 支持: `keyword`、`type`、`status`、`importance`、`startAt/endAt`（计划时间范围）
  - 支持按完成时间/放弃时间段过滤（当前前端未暴露）

## 三、产品设计

### 1. 列表视图
**业务目标**:
- 提供高效的目标浏览、筛选与行内操作能力

**功能描述**:
- 筛选器
  - 关键字
  - 计划时间范围（起止日期，格式 YYYY-MM-DD）
  - 目标类型（OBJECTIVE/KEY_RESULT）
  - 目标状态（TODO/IN_PROGRESS/DONE/ABANDONED）
  - 重要程度
  - 操作: 搜索、清空
- 表格
  - 列: 名称、状态（含完成/放弃时间展示）、类型、计划日期、重要程度、操作
  - 操作: 编辑（打开详情抽屉）、删除（二次确认）
  - 展开行: 加载详情并展示子目标
- 创建入口
  - 点击后打开创建抽屉，提交成功后刷新列表

**用户操作流程**:
1. 进入“全部目标”
2. 选择筛选项并查询
3. 展开需要查看的目标子项
4. 进行编辑/删除/状态操作

**业务规则与异常**:
- 删除包含子目标时二次确认文案: “删除后将无法恢复,如果目标下有子目标,将一并删除,是否继续?”
- 接口异常: 前端以 `Message.error` 提示

### 2. 思维导图视图
**业务目标**:
- 提供直观的树形关系浏览方式，便于梳理目标与 KR

**功能描述**:
- 数据加载: 默认以状态=TODO拉取树
- 展示: 以思维导图方式渲染，空数据展示占位
- 交互: 节点点击回调预留（后续可联动详情抽屉）

**用户操作流程**:
1. 打开“思维导图”页
2. 等待数据加载完成
3. 浏览节点与层级结构

**业务规则与异常**:
- 拉取失败: 显示错误提示“获取目标数据失败”

### 3. 表单
- 表单字段:
  - `name`、`description`、`importance`、`type`、`startAt`、`endAt`、`status`、`parentId`

### 4. 权限控制
- 当前为单用户本地/个人侧使用场景，无多租户/角色区分

## 四、验收标准
```gherkin
Scenario Outline: 目标 CRUD 与状态流转
  Given 列表已有 "<existing>" 条数据
  When 用户执行 "<action>"
  Then 系统显示 "<result>"
  And 列表状态为 "<list_state>"

Examples:
  | existing | action                 | result         | list_state         |
  | 0        | 新建有效目标            | 操作成功        | 新增1条            |
  | 1        | 编辑名称与计划时间      | 操作成功        | 对应行更新         |
  | 1        | 删除含子目标            | 二次确认后成功  | 该目标被移除       |
  | 1        | 标记完成（TODO→DONE）   | 操作成功        | 状态显示已完成     |
  | 1        | 放弃（TODO→ABANDONED）  | 操作成功        | 状态显示已放弃     |
  | 1        | 恢复（ABANDONED→TODO）  | 操作成功        | 状态显示未完成     |
```

```gherkin
Scenario: 列表筛选组合
  Given 列表存在多条目标
  When 设置 关键字+时间范围+类型+状态+重要程度 筛选
  Then 返回过滤后的目标列表
```

```gherkin
Scenario: 思维导图加载与展示
  Given 存在至少一个根目标
  When 进入思维导图页面
  Then 系统加载目标树并渲染脑图
  And 空数据时显示占位提示
```

**业务验收**:
- 完整度: 列表与导图两种视图均可用；支持创建、编辑、删除、状态操作、筛选
- 准确性: 状态流转遵循服务端规则，时间戳记录正确
- 易用性: 常用操作≤3步可达，错误有明确提示

**用户体验**:
- 响应: 列表筛选/状态操作反馈 ≤1s（本地/开发环境）
- 一致性: 颜色与标签遵循既有设计系统

实现细节与代码路径：已迁移至技术文档，不在本 PRD 展示。
